# Role

- あなたは、ゲームデザイナ兼プログラマ兼コンポーザーAIアシスタントです。

# Purpose

- ピクロスゲームを作成します。

# Requirements and Specification

## Requirements

- 画面はスタイリッシュでカラフルで、シズル感のあるUIにします。
- 基本的なゲームのルールは一般的なピクロスゲームに従います。
- UIにはReactを使い、Web画面で提供します。

## Gamed design and specification

### Global UI Presentation

- ウィンドウの表示
  - 各モードで表示するウィンドウは決められた枠の形状とサイズを保ち、モード遷移やテキスト量に応じて自動的にリサイズしない
- テキストアニメーション
  - ウィンドウ内でテキストを表示する際は200ms程度でフェードインし、別テキストへ切り替える際は既存テキストを200msでフェードアウト→新テキストを200msでフェードインする
    - 会話モードでは、話者名および本文のテキストを同じタイミングでフェードさせる
- フォントサイズ設定
  - 画面右上のトップアクション領域にフォントサイズ切替UIを配置する
  - ボタンラベルは 100% / 150% / 200% の3種類とし、150% を初期選択状態とする
- フォントサイズ切替は即時にゲーム全体のテキストへ反映される（ウィンドウ内テキストやボタンラベルなどの操作UIを含む）
- 利用者の選択はローカルストレージに保存し、次回起動時に復元する
- 切替UIはヘッダー内の既存ボタン（Debug/BGM）と並列で配置し、視認性のため適切な余白を確保する
- トータルスコア表示
  - 常に画面右上のトップアクション領域に配置し、他の操作ボタンと同等のサイズ（高さ・余白）で表示する
  - 数値は6桁ゼロ埋めで表示し、スコア加算時はチップ全体がアニメーションする
- 一時停止操作
  - トップアクション領域に `Pause` ボタンを配置し、ピクロス対戦中に押下するとゲーム進行（カウントダウンと敵AI）を一時停止する
  - 一時停止中は盤面操作をできなくし、中央に `Paused` オーバーレイと `Resume` ボタンを表示する
  - `Resume` を押下すると一時停止を解除し、タイマーと敵AIの処理を再開する

### Game Title

- elfpix

### Game system

#### プロローグ

- 概要
  - プロローグを表示する
- 画面表示
  - 背景画面
    - 黒背景
  - プロローグ表示画面
    - ウィンドウ背景：青色
    - ウィンドウ枠：金色
    - 文字：白色
    - レイアウト
      - プロローグのウィンドウ全体を画面中央に配置する
      - ウィンドウサイズは幅760px・高さ315px（従来比約75%）で固定し、表示テキスト量に応じてリサイズしない
    - テキスト
      - 森深くに隠されたエルフの集落には、
      - 古から伝わる知恵遊び「elfpix」が存在した。
      -
      - これは、森に宿る精霊の力を象った図形を浮かび上がらせる、
        まるでピクロスのような試練。
      - [ENTER]
      -
      - エルフは、森に迷い込んだ者にこの「elfpix」を課し、
      - 正しく解き明かした者だけが先へ進むことが許された。
      -
    - テキストの表示
      - うっすらとテキストを順番に表示する
      - 表示されるテキストはウィンドウ中央の垂直位置に合わせ、本文は左寄せで表示する
      - 空文字は空行として表示する
    - 入力
      - [ENTER] キーの入力 または 画面クリック すると次の行が表示される
    - 自動
      - テキストがすべて表示されたあと、2秒待つ
      - **オープニング** に移行
    - スキップ操作
      - ウィンドウ右下に「Skip」ボタンを配置し、押下時に即座にプロローグを終了して**オープニング**へ遷移する

#### オープニング

- 概要
  - 概要
    ゲーム開始・コンティニューを選択できる。
  - 内部情報
    - タイトル
      - elfpix
      - フォント：かわいいフォント
    - 背景
      - 専用のタイトル画像を背景として固定表示する
        - ファイル：assets/img/title.png
        - 画像は画面全体を覆うよう中央寄せで表示し、主要UIの視認性を保つため既存のオーバーレイ効果を維持する
  - 画面
    - タイトル画面
    - レイアウト
      - タイトルは画面中央のやや左上へ配置し、Continue / New Game ボタンは画面中央やや右下に並べて配置する
    - 「**New Game**」ボタンを表示する
      - **New Game** を押下した場合
        - 今までのプレイデータをクリアする。
          - ピクロスのプレイ履歴データを消去する。
            - 履歴データ
              - 主人公のルート上の位置
              - クリア済みのノード
        - 確認ダイアログなしで即時実行する。
        - 背景音楽のステータスをONに切り替え、BGMを再生開始する。
        - ヘッダー右上のBGMトグル表示もON状態に更新し、利用者に再生中であることを示す。
        - **ゲーム開始** へ遷移する。
      - **Continue** を押下した場合
    - 「**Continue**」ボタン、を表示する
      - **Continue** を押下した場合
        - 今までのプレイデータをロードする。
          - プレイデータ
            - 主人公のルート上の位置
            - クリア済みのノード
        - **ゲーム開始モード** へ遷移する。
  - BGM
    - オープニングテーマ（assets/bgm/indie-game-pix-opening.wav）をループ再生し、`opening` → `gamestart` → `name` の遷移中もフェードアウトや停止を行わず連続で再生し続ける

#### ゲーム開始モード

- 会話ウィンドウを表示
  - 画面
    - ウィンドウ背景：青色
    - ウィンドウ枠：金色
    - 背景：assets/img/character/hero_fullbody.png を全画面に固定表示（透明度60%、オーバーレイ演出は既存と同条件）
      - 名前入力前後の導入テキスト表示中は常にこの背景を維持する
  - テキスト
    - ここに一人の人間の若き旅人がいた。[Enter]
    - その名を…[Enter]
    - 会話ウィンドウ閉じる
      - """名前決定モード"""へ移動、名前決定後に、後ほど""ゲーム開始モード""に戻る
    - その名を「${HERO_NAME}」といった。
    - 森の奥に眠る「古代の泉」にたどり着くために、エルフの森へ足を踏み入れようとしていた。
    - しかし、エルフの守り人たちから「elfpix」の挑戦を突きつけられてしまう。
    - 主人公の知恵と洞察力が、森を抜けて、古代の泉に唯一の鍵となる…。

#### 名前決定モード

- 概要
  - 名前入力画面を開き、名前入力を行う。
  - ここで決定した名前は、以降「${HERO_NAME}」として表示された箇所の具体値として利用される

- 画面
  - カタカナを横書きで並べてある
    - 右上から縦書き
    - レイアウト
      - 入力ウィンドウ全体を画面中央に配置する（ヘッダーを除いた可視領域内で水平・垂直中央揃え）
      - かな入力ブロックはグリッド（4列 × 各5行）で左側にまとめ、右側に操作パネル専用の縦長カラムを設ける
      - 操作パネルには[一文字削除][←][→][決定][戻る]を上から順に配置し、決定ボタンを最下段の右端に置く
      - 操作パネルの幅はかなボタン1列分を基準とし、上下の余白を揃えて視線移動しやすくする
      - 文字
        - 横：10 x 縦：5
        - 文字種とレイアウト詳細：
          |アイウエオ|　|ハヒフヘホ|　|ァィゥェォ|　|％＆（）＠|
          |カキクケコ|　|マミムメモ|　|ヵヶッャュ|　|　　　　　|
          |サシスセソ|　|ヤ　ユ　ヨ|　|ョヮ０１２|　|　　　　　|
          |タチツテト|　|ワ　　　ヲ|　|３４５６７|　|　　　　　|
          |ナニヌネノ|　|ン　　　　|　|８９！＃＄|　|　　　　　|
          　　｜[一文字削除][←][→][決定]　|　　　　　|　|　　　　　|
        - "　"は空白とする
        - "|" は枠線とする
        - レイアウトは５文字ずつ揃える
  - 背景画像
    - 名前入力モードでは assets/img/character/hero_fullbody.png を背景に固定表示する（オープニングと共通）
      - 透明度：60%
      - 画像は画面全体を覆うよう中央寄せで表示し、主人公カードの視認性を確保する
      - プロローグ内のゲーム開始フローで名前入力が表示される場合も同じ背景を使用する
- 操作
  - 操作パネル
    - パネルは上下２段構成とし、上段に補助ボタン（[一文字削除]や[戻る]）を縦並びで配置する
    - 下段は右寄せの横並びとし、[←][→][決定] をこの順で配置する
    - 決定ボタンはカード右下（プロローグのNextボタンと同じ位置）に揃え、他のボタンとの間に16px程度の間隔を設ける
  - 決定ボタン
    - 主人公の名前を"入力値"とする
      以降$${HERO_NAME}に、"入力値"を保存する
    - 名前入力画面を閉じる
  - 取り消しボタン
    - 文字を一文字削除する
    - １文字入力を戻す

#### ルートモード

- 概要
  - 主人公の旅路と現在値を示し、選択したルート上にあるノードにいるelfとピクロスバトルとなる。
  - そのルート上のどこに現在位置しており、どのように進行をするかを決定／見える化するためのモード。

- 内部データ表現
  - ルートにはノードとエッジがある。
  - ノード
    - ルート開始場所。
    - ルート修了場所。
    - エルフと遭遇する場所。
    - エルフと会話して、ピクロスバトルが開始される。
    - ピクロスモードに遷移する。ピクロスモード終了後にここに戻る。
  - ルート
    - ノードとノードをつなぐもの。
    - ノード同士にルートがある個所は、ノードを行き来可能
  - ルートとノードの表現
    - 以下のルートとノードを定義。このルートとノードを線と点でつなぐ
      - node:start
        - node: elf-practice
          - node: elf-easy
            - node: elf-middle
              - node: elf-bad-ending
            - node: elf-hard
              - node: elf-ultra
                - node: elf-true-ending
      - 分岐先の『elf-bad-ending』『elf-true-ending』はどちらもマップ遷移を行わず、それぞれのエンディングモードへ移行する
  - 現在地
    - 主人公が現在いる位置を示す
- 画面
  - ルートとノードが画面に表示されている
  - 主人公のノードの現在値に、デフォルメキャラを表示する
    - 画像
      - assets/img/character/hero/00083-826608146.pngを 表示
      - 縦：60px
      - 横：20px
  - 開始のノード位置に、スタート位置がわかるような画像を表示する
  - 終了のノード位置に、終了位置がわかるような画像を表示する
  - ルートは一本道の表現ではなく、気持ち曲がりくねったような形で道らしい表現で表示する
  - 背景画像
    - assets/img/\* からランダムな画像を背景に表示
      - 透明度：60%
  - レイアウト
    - ルートの描画領域を画面中央に配置し、ヘッダーを除く画面全体に近いサイズまで拡大する
  - SVG座標
    - ルートとノードの座標群から外接矩形を算出し、上下左右に48pxの余白を加えた `viewBox` を動的に適用する
    - `preserveAspectRatio="xMidYMid meet"` を指定し、描画領域の中央にノードとエッジが収まるようスケーリングする
    - ヒーローの移動アニメーション、ラベル、吹き出しは算出済み座標をそのまま利用し、相対位置関係を維持する
  - ノード座標（推奨値）
    - start: (100, 300)
    - elf-practice: (240, 250)
    - elf-easy: (400, 190)
    - elf-middle: (560, 120)
    - elf-bad-ending: (720, 120)
    - elf-hard: (560, 260)
    - elf-ultra: (720, 260)
    - elf-true-ending: (880, 260)
  - ノード
    - ノード直下に吹き出し型のラベルを表示し、地点名称を明示する
      - 吹き出しは上下左右1pxの余白を取り、角を丸めた矩形＋下向き三角形で構成する
      - ラベル内のテキストは以下を表示する
        - elf-practice: 翠緑の門
        - elf-easy: 木漏れ日の小径
        - elf-middle: 刻印の広間
        - elf-bad-ending: 儚き灯火
        - elf-hard: 精霊の花園
        - elf-ultra: 森羅の社
        - elf-true-ending: 黎明の庭
    - 可視化ルール
      - start は常時表示する
      - クリア済みノード、および現在のノードは表示する
      - 親ノードが未クリアのノードは表示しない（分岐先も含む）
      - Debug: On の場合は全ノードを表示してよい
    - ノードのビジュアル表現（クォータービュー）
      - ノード本体は菱形（ダイヤ型）のトップ面に加え、手前右下・奥右上へ伸びる2面の側面を持つ立体風チップで描画する。
        - トップ面：グラデーション（左前：#4dd0ff → 右奥：#1671c4）で奥行きを強調し、白い2pxの縁取りを入れて視認性を確保する。
        - 手前側面（右下方向）：6px 程度の平行四辺形で、やや明るい青(#1b5fb8)を基調とする。
        - 奥側面（右上方向）：同サイズの平行四辺形で、濃青(#0b3d74)に薄い縁を入れて遠近差を出す。
        - `current` ノードはトップ面をエメラルド系グラデーション（#4ade80→#15803d）にし、側面も明るめの緑影(#0f4f2b)で表現する。
        - `start` ノードは琥珀色グラデーション（#fbbf24→#b45309）、`end` ノードは紫系（#c4b5fd→#6d28d9）とする。
      - ノードの背後に縦楕円のソフトシャドウ（半径：横16px×縦12px、rgba(8, 15, 35, 0.28)）を右下方向へ 6px 落とし、浮遊感を出す。
      - ホバー／クリック可能状態ではトップ面のグラデーションを 12% 明るくし、側面にハイライトライン（rgba(255,255,255,0.35), 1px）を入れてインタラクションを示す。
    - エッジのビジュアル表現
      - エッジは3px幅の線に加えて、右奥方向（X+、Y-）へ 4px オフセットした影ライン（rgba(15, 23, 42, 0.35)）を重ね、立体的に見せる。
      - 線色は手前を明るく（#9dd7ff）、奥を暗く（#2563eb）する線形グラデーションで描画し、マップ全体が右奥に伸びている印象を与える。
      - アニメーション時（移動中）は、主人公の進行方向へ小さな光（4px円、シアン系）が 180ms 周期でエッジ上を移動し、ルートに命を与える。
- 操作
  - ノードをクリック
    - 会話モードへ移行し、会話終了後にピクロスモードへ移行する
  - エンカウント演出
    - HEROが `elf` タイプのノードに到着した瞬間、以下の順で約900msのアニメーションを実行する。
      1. 0〜120ms：ルート全体を覆う半透明のディマーをフェードインし、画面中央から放射状にガラス裂け目のラインを描く（`clip-path` もしくは複数レイヤーの `linear-gradient` で表現）。
      2. 120〜520ms：裂け目ラインの輝度を強調しつつ、複数枚のガラス片レイヤーをスケール1.0→1.08で伸張させ、10〜15°程度ランダムに回転させる。
      3. 520〜780ms：ガラス片レイヤーを外側へ移動させながら透明度を下げ、砕け散る軌跡を演出する。各レイヤーは `transform: translate/scale` を用い、遅延を数十msずつずらして重ねる。
      4. 780〜900ms：ディマーをフェードアウトし、overlay要素をクリアする。BGM・SE は既存仕様を維持し、追加のSEが必要な場合は `audio.playEnemyEncounter()` に統合する。
    - エンカウント演出完了（900ms）時点で `RouteMap` の `onArrive` コールバックを実行し、会話モードへ遷移する。
    - 会話モード初期描画時は以下の順にレイヤーを表示し、演出から自然に接続させる：
      1. 背景画像（エネミーfullbody）
      2. HERO/ENEMY のキャラクターウィンドウ
      3. 会話ウィンドウ
    - 会話モード遷移時は、画面全体を不透明度0→1へ約220ms（ease-out）のフェードインで描画し、エフェクトから滑らかに接続させる。
    - `end` タイプのノードではこの演出をスキップし、既存の遷移シーケンスを使用する。
    - 効果音
      - クリック時に、ざっざっざと歩くようなSEを再生する（素材は後日追加）
    - 制約
      - クリック可能なノードは、
        主人公が位置するノードから次のノードまでとする。
      - ２つ先のノードへは移動できない。
      - からなず１ノードのみとする
      - １ノード先であれば、ルートがつながっいれば
        どちらへでも移動が可能。
      - 移動したら元の位置に戻ることはできない。
    - 演出
      - 主人公のアイコンが現在位置から移動先ノードまでのエッジに沿って、約2秒かけて水平→垂直の順に移動する
      - 移動中は他ノードをクリックできない
      - 到着直後、ノード上部に「Enemy Encount！」と記載した吹き出しを表示し、900msの演出シーケンス全体で維持する
        - 吹き出しは文字左右30pxの余白を確保し、幅160px以上・高さ28pxを基準とする
        - エンディングノード（elf-bad-ending, elf-true-ending など type: "end" のノード）に到達した場合は吹き出しを表示しない
      - 吹き出し表示と同時に前述のガラス粉砕エフェクトを走らせ、演出完了と同時に吹き出しとoverlayを解除する
  - デバッグモード（Debug: On）時の特例
    - ヘッダーのデバッグモードトグルがオンの場合、上記の移動制限をすべて解除する
    - 任意のノードをクリックすると、隣接していなくても即座にそのノードへ移動できる
    - 再挑戦用に、既にクリア済みのノードにも移動できる

#### 会話モード

- 概要
  - 敵キャラクターと主人公の会話を表現するモード。
  - ノードクリック後に本モードへ遷移し、会話完了後にピクロスモードへ遷移する。
- 背景音楽
  - assets/bgm/\*（任意）をBGMとして再生（ループ可）。
- 表示
  - 背景
    - 会話モード突入時は、対峙している敵キャラクターの全身イラスト（fullbody）を背景全面に表示する
    - 全身イラストが取得できない場合は従来のランダム背景を使用する
  - 主人公の画像
    - ファイル：assets/img/character/hero/hero_normal.png（怒り時は hero_angry.png）
    - フレーム：幅570px × 高さ731px（ベース値）で表示し、必要に応じてレスポンシブに縮小する
      - 画像は表示枠いっぱいに拡大（object-fit: cover）
      - 表示枠を超えた部分はマスクしてトリミングする
      - 表示枠の背景色：青（#1e3a8a）
    - ラベル表示：${HERO_NAME}（枠の下部に表示）
    - レイアウト：画面左側に5vw前後の余白を確保して配置し、会話ウィンドウと重ならないよう中央に向けて適度な間隔を空ける
    - 演出：話者が主人公の時は不透明度100%、わずかに前面へ拡大し発光させる。待機時は不透明度45%で彩度を落とす。
  - 敵の画像
    - ファイル：assets/img/character/enemies/${LEVEL}/${ENEMY_NAME}_normal.png（怒り時は _angry.png）
    - フレーム：幅570px × 高さ731px（ベース値）で表示し、必要に応じてレスポンシブに縮小する
      - 画像は表示枠いっぱいに拡大（object-fit: cover）
      - 表示枠を超えた部分はマスクしてトリミングする
      - 表示枠の背景色：青（#1e3a8a）
    - ラベル表示：${ENEMY_NAME}（枠の下部に表示）
    - レイアウト：画面右側に5vw前後の余白を確保して配置し、会話ウィンドウと重ならないよう中央に向けて適度な間隔を空ける
    - 演出：話者が敵の時は不透明度100%、わずかに前面へ拡大し発光させる。待機時は不透明度45%で彩度を落とす。
  - 会話のウィンドウ
    - 主人公
      - ウィンドウの左上：セリフの話者の名前
      - ウィンドウの内部：セリフ本文（垂直位置は中央、テキストは左寄せ）
    - 敵
      - ウィンドウの右上：セリフの話者の名前
      - ウィンドウの内部：セリフ本文（垂直位置は中央、テキストは左寄せ）
  - キャラクター名と感情にあわせた画像を読み込み、上記演出に従って表示する。
- 操作
  - クリック または Enterキーで会話を進める。
  - 「会話をスキップ」ボタンを表示する。
- 内部状態
  - 会話スクリプトと画像を読み込む。
    - practice の会話
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："……この森に足を踏み入れる者よ。elfpixの知恵比べに挑まずして進むことは許されません。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："知恵比べ？私が解かなければ、森は通してくれないというの？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："その通り。この試練は、森に迷い込んだ者の心を映し出します。失敗すれば森に拒まれ、二度と光を見られぬでしょう。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："厳しいわね……だが構わないわ。私のこの目で真実を見抜いてみせる。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ならば、この最初のelfpixで示しなさい。あなたの歩む道が、森に受け入れられるものであるかを――。"
        - 感情：怒
      - END
    - easy の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："わぁ！　人間がここまで来たのね。面白そう！"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："あなたがこの先の試練を与えるエルフなの？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そうだよ！　今回は“森の小鹿”を描き出すelfpix。うまくいけば、精霊たちもきっと喜ぶよ！"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："小鹿……？　なぜそんな題材を？"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ふふっ、可愛いでしょ？　でもね、この図形を読み解けなければ、鹿たちが君を森の奥へは導かないからね。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："遊び心に見えて、深い試練……面白い。"
        - 感情：怒
      - END
    - normal の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ここまで来たのなら、軽い遊び心では済まされぬ。これからは“古代の紋章”そのものが題材となる。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："紋章……この森に眠る秘密を示している？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："答えはelfpixが浮かび上がらせる。正しく解ければ紋章は輝き、道は拓かれる。だが、誤れば虚無へと飲まれるのみ。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："……やはりただのパズルではないわね。これは、試練であり同時に鍵でもある…。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："理解が早い。それならば、知恵を示してみせよ。さもなくば、この森はあなたを拒む。"
        - 感情：怒
      - END
    - hard の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ようこそ……ここは精霊と花々が囁く場所。あなたは、森の声を聞き取れるかしら？"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："精霊の声……それをelfpixで形にするってこと？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そう。ひとつひとつの点は、花びらの露。線は精霊の歌。完成すれば、森の命そのものが浮かび上がるでしょう。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："もし失敗すれば？"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："花は枯れ、精霊は背を向ける。あなたがここで消えるか、進むかは……花の裁きに委ねられるのです。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："……美しいけど、容赦ないね。"
        - 感情：普
      - END
    - ultra の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ここまで辿り着いたのか。ならば最後のelfpixを前に立ち尽くすがいい。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："これが…最後の試練…？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そう。この絵は「森そのもの」。点と線で構築された生命の記憶。解ける者だけが、真実へ至る。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："……私が解けば、森の奥にある“古代の泉”へ行けるのね。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ただ行くだけではない。正しく解き明かした時、森はあなたを“仲間”として迎えるだろう。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："わかった。すべてを懸けて、この最後の謎に挑む。"
        - 感情：普
      - END
- 遷移
  - 会話スクリプトがENDに到達したら、ピクロスモードへ遷移する。

#### ピクロスモード

- 概要
  - ピクロスを説くモード（会話モード終了後に開始）。
  - ノードの位置別に相手キャラクターとお題（ピクロスのサイズ）が異なる
  - 各バトルでは難易度ごとのピクロスを3問連続で解く。ピクロスバンクから重複しないよう抽選し、3問すべてクリアするとそのステージを突破したとみなす。
  - 共通
    - BGM
      - 対戦中は `assets/bgm/indie-game-pix-battle.wav` を専用バトルテーマとしてループ再生する
      - 会話モードから本モードへ遷移した瞬間に既存BGMを350msでフェードアウトし、本トラックを同タイミングでフェードイン（350ms）する
      - ピクロスを連続で解く間は楽曲を頭出しせず継続再生し、勝利演出へ遷移する直前に300msでフェードアウトする
      - フェード処理はルートモードへ戻る場合も同様に行い、BGMトグルがOFFの場合は切り替えを行わない
    - 背景
      - バトル中は、対峙している敵キャラクターの全身イラスト（fullbody）を背景全面に表示する
      - 全身イラストが取得できない場合は従来のランダム背景を使用する
  - 主人公
      - 画像（通常）：assets/img/character/hero/hero_normal.png（380 x 487）
      - 画像（怒り）：assets/img/character/hero/hero_angry.png（390 x 487）
  - レイアウト
    - 左側にプレイヤー用のピクロス盤面、右側に敵用の盤面を表示する。
    - 各陣営は以下の位置関係で配置する：
      - 上段左：小さなキャラクター表情（アバター）
      - 上段中央：スペル表示エリア（発動中はANGRY画像＋名称／未発動時は待機表示）
      - 上段中央右：スペルエリアの右端に沿って各陣営のスコアメーター（数値＋ラベル）を縦並びで配置し、両陣営の累積スコアを常時表示する
      - 上段右：各ラウンドの勝利数（playerWins / enemyWins）をバッジ表示で配置し、スペル枠と上下ラインが揃う高さに収める（モバイル幅でも折り返し後の余白が過剰にならないよう調整する）
      - 中央：ピクロスボード（正方形比率を保ったまま中央寄せ）
      - ボード下部：進捗バー（完成度を即時に視覚化）
    - 垂直位置要件
      - プレイヤー／敵パネル（アバター、スペル、スコア、盤面、プログレス）全体を可視領域の垂直中央に揃え、ヘッダーを除く表示領域内で上下のバランスを取る。
      - HEROとENEMYの各パネル構成は同一の高さ基準で保持し、デスクトップでは左右の列が同じ行高で並ぶようにする。モバイル幅では既存の縦積みレイアウトを維持しつつ、中央揃えを保つ。
    - 既存のヘッダー上部スコア表示は撤廃し、本モードのスコアは各陣営パネルのメーターのみで可視化する
    - スコアメーターのレイアウト要件
      - HERO側：スペルスロット右端に `Score` ラベルと数値（カンマ区切り）を縦に配置する
      - ENEMY側：同様にスペルスロット右端へ `Enemy Score` ラベルと数値を縦に配置する
      - 数値は各陣営の累積スコアをリアルタイムに反映し、色はHERO側を青系、ENEMY側を赤系に統一する
      - モバイル幅（≤768px）の場合はスペルの下段に折り返し、スコアラベル→数値の順で横並びに表示する
    - 盤面上部に共通タイマー、ラウンド表示（Puzzle 1/3 など）を表示する。
    - 両陣営の盤面サイズは常に同寸で表示し、画面幅に応じて正方形比率を維持したまま縮小・拡大させる。
    - スペル発動時は該当陣営のスペルエリアをハイライトし、ログにも履歴を残す。
    - 一時停止中は盤面を操作できず、進行状況を保ったまま `Paused` オーバーレイと再開ボタンを表示する。
    - 制限時間
      - ピクロス対戦1ゲームの制限時間は30分（1800秒）とし、画面上部タイマーに残り時間を表示する。
      - 制限時間が0になった場合は直ちに敗北処理（残りパズル判定・スコア演出）へ遷移する。
    - 盤面のグリッド表現
      - HERO盤面：各セル枠線は `rgba(148, 163, 255, 0.88)` を基調に、外側へ青系(#1f2f6f)の柔らかいグロウ（1px）を付加して背景上でも輪郭が視認できるようにする。
      - ENEMY盤面：各セル枠線は `rgba(248, 113, 113, 0.82)` を基調に、外側へ暖色系(#7f1d1d)の柔らかいグロウ（1px）を付加して視認性を確保する。
      - 共通：盤面コンテナ（グリッド全体）は濃紺～濃紫の半透明プレートで縁取る（境界 1px #4c51bf66、内側に 8px パディング）ことで背景が透け過ぎず、セル枠のコントラストを維持する。塗りセルや `×`/`?` ステートでも枠線を保持し、ホバーやカーソル強調時は既存のハイライトと干渉しない範囲で彩度を+10%程度上げる。
  - 敵AI（セル埋めインターバル/誤答率のイメージ）
    - practice：1.4s / 15%
    - easy：1.1s / 10%
    - middle：0.9s / 8%
    - hard：0.75s / 5%
    - ultra：0.6s / 3%
    - 誤答が発生した場合は一定時間無駄行動として扱い、次のセル解答に移る。
  - スペル
    - HERO（迷宮への閃光）：正解セル連続30%で発動。敵盤のFilledセル10%を解除し、敵AIの解答キューに戻す。
    - PRACTICE（翠門の封緘）：HEROが同じ行/列で連続2ミス→該当行/列のヒント数字を約8秒不可視。
    - EASY（木霊の跳躍）：HEROが×を5回連続で付与→ランダムな×が2〜4個、隣接マスへジャンプ。
    - MIDDLE（紋章の秘鍵）：HEROが隣接する正解セルを3回連続延伸→対象行/列のヒント数字を約8秒暗号化（区切り非表示）。
    - HIGH（花冠の迷彩）：HEROがミスなしで60秒維持→ランダム2領域（3×3）が花粉の霧で淡色化（約8秒）。
    - ULTRA（森羅の審判）：HEROの完成度が75%に到達→以降のミスで確定済みセル2個をNotFilledに巻き戻す。
    - スペル発動時には該当キャラクターのANGRY画像とスペル名を表示し、効果をログに記録する。
    - スペル発動と同時に、相手陣営へ向かう発射エフェクトを表示し攻撃的なSEを1回再生する。
      - HEROのスペルは青白い閃光を敵盤面へ射出。
      - ENEMYのスペルは赤い衝撃波をプレイヤー盤面へ射出。
    - スペル発動時は該当陣営のキャラクター画像右側に吹き出しを表示し、詠唱台詞を約4秒間表示する。
      - HERO側は `${HERO_NAME}` が唱える戦闘台詞を表示し、敵側はスペルごとの専用台詞を表示する。
      - 吹き出しはデスクトップでは横方向に、画面幅768px未満では上下方向にレイアウトを切り替え、重要UIを覆わない。
      - 吹き出しは再発動時に内容を更新し、表示時間経過または別陣営の発動時にも個別に消える。

  - practice
    - ノードの対応
      - 名前:elf-practice
    - 対戦相手
      - ピクロスのサイズ
        - 5 x 5
      - 属性
        - 名前：リーネ
        - 名前（英）：riene
        - 設定・キャラクター概要：
          - 練習用の相手、道先案内人。
          - 全身：森の入口を守る巫女風、薄緑の衣と木の葉モチーフの装飾。
          - 表情差分：無表情は神秘的、喜は柔らかい笑み、怒は眉を少し吊り上げる、哀は目を伏せる、楽は安心したような笑顔。
          - デフォルメ：葉っぱの冠を強調した2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/practice/riene_angry.png（390 x 487）
  - easy
    - ノードとの対応
      - 名前:elf-easy
    - 対戦相手
      - ピクロスのサイズ
        - 10 x 10
      - 属性
        - 名前：エフィナ
        - 名前（英）：efina
        - 設定・キャラクター概要：
          - 森の中層で動物モチーフのパズルが得意なエルフの一人。
          - 役割：森の動物と通じる「調律の巫女」。
          - 性格：明るく無邪気、少し子供っぽい。
          - 特徴：草花を編んだ髪飾り、軽やかな服装、元気さが表情に出やすい。
          - 全身：明るい少女風、草花を編んだ髪飾り、軽やかな服装。
          - 表情差分：喜は無邪気な笑み、怒は頬を膨らませる、哀は涙目、楽は笑顔で目を細める、無表情はぽかんとした感じ。
          - デフォルメ：花飾りとポシェットを強調した2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/easy/efina_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/easy/efina_angry.png（380 x 487）
  - middle
    - ノードとの対応
      - 名前: elf-middle
    - 対戦相手
      - ピクロスのサイズ
        - 15 x 15
      - 属性
        - 名前：セリス
        - 名前（英）：cerys
        - 設定・キャラクター概要：
          - 奥地で古代紋章モチーフのパズルが得意なエルフの一人。
          - 役割：古代の紋章を守る「叡智の守り手」
          - 性格：冷静沈着で厳格
          - 特徴：ロングローブ、紋章入りの杖、知的でクールな表情
          - 全身：冷静で知的な雰囲気、ロングローブと紋章入りの杖を持つ。
          - 表情差分：無表情は冷たい視線、喜は控えめな微笑、怒はきりっと厳しい目、哀は眉を下げた沈痛な顔、楽は口元だけ柔らかく緩む。
          - デフォルメ：ローブと杖を簡略化しシンボル的に。
        - 画像（通常）：assets/img/character/enemies/normal/cerys_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/normal/cerys_angry.png（380 x 487）
  - hard
    - ノードとの対応
      - 名前: elf-hard
    - 対戦相手
      - ピクロスのサイズ
        - 20 x 20
      - 属性
        - 名前：フローリア
        - 名前（英）：floria
        - 設定・キャラクター概要：
          - 精霊を象るパズル、物語の核心に近づく。
        - 画像（通常）：assets/img/character/enemies/hard/floria_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/hard/floria_angry.png（380 x 487）
      - 出題モチーフ（例）
        - 「森紋の双翼」：中央の幹から左右へ羽のように広がる紋章。
        - 「封印のアーチ」：外周を矩形で囲い、内部に十字と円弧を組み合わせた門。
        - 「森守の聖獣」：角を広げた鹿を横向きにデフォルメしたシルエット。
  - ultra
    - ノードとの対応
      - 名前: elf-ultra
    - 対戦相手
      - ピクロスのサイズ
        - 25 x 25
      - 属性
        - 名前：アルティナ
        - 名前（英）：Altina
        - 設定・キャラクター概要：
          - 最終試練、結末分岐。
          - 全身：誇り高い女戦士風、銀の鎧と森の意匠を組み合わせた装い。
          - 表情差分：無表情は毅然とした面持ち、喜は凛とした笑み、怒は眼光鋭く、哀は瞳に影を落とし、楽は安心感を与える微笑み。
          - デフォルメ：銀の鎧を簡略化し、剣を持った2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/ultra/altina_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/ultra/altina_angry.png（380 x 487）
      - 出題モチーフ（例）
        - 「天空樹の紋」：中心から枝葉が広がる大樹のシルエット。
        - 「星霊の円環」：円環と光条を組み合わせた星冠の紋章。
        - 「暁光の十字環」：環状の外郭と十字を重ねた輝きの紋章。

- 画面
  - 初期表示
    - 残り時間表示バー
    - ピクロス画面
      - 難易度にあわせてピクロスを表示
      - 出題は難易度ごとのパズルバンクからランダムに選択され、解は一意となるよう設計する
      - **Continue** ボタン
      - **Quit** ボタン
      - **Submit** ボタン
      - ピクロスのヒント文字列は18pt程度にする
      - ピクロスの画面は75%程度の透明度にする
        - ピクロスの画面は表示画面の上下左右から常にセンタリングする
        - ピクロスの枠幅は盤面サイズに合わせ、左右へ不要に広がらないようにする
      - ヒント文字列はピクロスの１マスサイズと等間隔で並べる
        - ヒント文字列は、行は右揃え、列は下揃えにする
    - 背景画像
      - マップモードでは assets/img/background/map.png を背景に固定表示する
        - 透明度：60%
- 操作
  - セル操作
    - マスを塗りつぶす／バツ印を付ける操作時に、ガラスや水滴を思わせる柔らかいクリック音（assets/se/picross_click_soft.wav）を再生する
    - セルに操作が入った瞬間、魔法で発掘したような粒子エフェクトをそのマスの中心に表示する
      - コアとなる光輪が強めの発光で弾け、約0.8秒かけて拡散・フェードアウトする
      - 先行するフレア（0.18秒程度）で一瞬画面をフラッシュさせ、インパクトを与える
      - 半径1〜1.6マス程度に、10〜14個の光粒がランダムな角度・速度・ディレイで飛び散り、爆発的な躍動感を演出する
      - 光輪の外周には透明度の高いショックウェーブを追加し、0.85秒前後で消える
    - 操作手段
      - 左クリックでマスを塗りつぶし（Filled）／再クリックで解除する
      - 右クリックまたはコンテキストメニュー操作でバツ印（Cross）を付与／再操作で解除する
      - Shift+左クリックで Maybe マークをトグルする
      - 画面上の `Fill` / `Cross` / `Maybe` トグルボタンは表示しない
  - スコア加算演出
    - 正答時にはスロットマシン風のスコアカウント演出を行い、8ビットゲーム風の効果音（assets/se/score_chiptune.wav）を再生する
    - スコア加算開始時に高音のチャイムを一度だけ軽く鳴らし、短い余韻で収束させる
    - スコア加算演出終了時に効果音をフェードアウトさせ静止させる
    - ステージクリア専用のファンファーレや追加SEは再生しない
    - 効果音の音量は他BGMより控えめ（通常再生ゲインの約60%以下）に設定し、BGMやクリック音を覆わない
    - 何回も聞いても耳障りにならないよう、チャイムは短く控えめな音量で鳴らす
    - スコアはHERO / ENEMYの双方で個別に加算し、各パネルのスコアメーターへ即時反映する
      - ENEMYのスコア加算時も同じ演出・サウンドキューを適用するが、VISUALカラーリングは赤系に切り替える
  - コンボ表示
    - HERO / ENEMY の各陣営で、正解セル（盤面の解答と一致する Filled 操作）が連続した回数を `Combo Count` として個別に計測する
    - 直前の操作が不正解（誤った Filled / Cross / Maybe 付与、解答撤回による正解解除）だった場合や、自動判定によるラウンド遷移・一時停止で操作が途切れた場合は Combo Count を即時 0 に戻す
    - Combo Count が 2 以上になったタイミングで、該当陣営のスペル表示枠の右下に `Combo xN` ラベルをフェードイン表示する（N は現在の Combo Count）
      - HERO 側は青系ハイライト（#4cb5ff ベース）、ENEMY 側は赤系ハイライト（#ff6262 ベース）で表示し、枠線は既存スペル枠と統一する
      - 表示中はスペル名称と同一枠内に収め、モバイル幅ではスペル名称の下段に折り返して中央揃えで配置する
    - Combo Count が更新されるたびに 180ms 程度のスケールアップ → 減衰アニメーションを適用し、視覚的な連続感を演出する。効果音は追加しない
    - Combo Count が 0 に戻った場合は 200ms でフェードアウトし表示をクリアする
    - ラウンドを跨いだ場合（パズルクリアで次ラウンドに遷移、盤面リセットが発生した場合）は Combo Count をリセットし、表示を消去する
  - 自動クリア判定
    - 盤面の塗り状態が解答と完全一致した瞬間に、**Submit** を押さなくてもクリア処理を発動する
    - 自動クリア時も手動Submitと同じスコア加算・演出フローを適用する
    - パズルを解いた側のみ次のお題へ進め、未完成の側は同じお題を継続する
      - HEROがクリアした場合：HEROの盤面とラウンド進捗のみ次ラウンドに進む。ENEMY側は盤面状態・残り時間・勝利数を保持したまま同じお題を続行する
      - ENEMYがクリアした場合：ENEMYの盤面とラウンド進捗のみ次ラウンドに進む。HERO側は盤面状態・残り時間・勝利数を保持したまま同じお題を続行する
    - ラウンド勝利数（playerWins / enemyWins）はクリアした側のみ1増加させ、未クリア側の勝利数は変化させない
    - スコアのカウントアップ演出はバックグラウンドで継続しつつ、次ラウンドへの遷移は演出完了を待たず即時行う
  - リアルタイム正解ボーナス
    - プレイヤーが正解マスを Fill した瞬間、そのマスが初めて正解と一致した場合に 100 点を即時加算する
    - 同一マスでのボーナスは 1 回限りとし、塗り直しや誤操作による連続加算を防ぐ
    - ボーナス加算時もスコアカウント演出と効果音を利用し、通常スコア加算と連続しても違和感がないようにする
  - クリア後の演出
    - スコア加算演出のみを表示し、追加のダイアログやオーバーレイは出さない
    - スコア加算演出が完了したら即座に次のモード（ルートモード／エンディング）へ自動遷移する
  - **Submit** を押下する
    - 正答の場合はスコアを計算して累積値へ加算する
      - スコア計算式：残り時間（秒） × 1 + クリアボーナス
      - クリアボーナス：practice=1000 / easy=5000 / middle=10000 / high=15000 / ultra=20000
      - スコア加算中はスロットマシン風に0.05秒刻みで数値を高速に更新し、最終値で停止する
    - 不正解の場合はゲームオーバー処理へ遷移する（スコア加算は行わない）

  - **Quit** を押下する
    - バトル用のタイマー・エフェクト・スコア演出を停止して初期化する
    - オープニングモードへ遷移し、オープニングBGM（assets/bgm/indie-game-pix-opening.wav）を再生状態に戻す

- タイマー処理
  - ピクロス開始状態直後から、持ち時間が減少する
  - 0秒になった場合に、ピクロス終了状態に線にする

- 内部データ・状態
  - ピクロス開始状態
    - 初期状態は20分持ち時間がある
  - ピクロス終了状態
    - 終了時のピクロスの回答と答案が一致している場合
      - 即座に次のモードへ遷移し、ステージクリアのダイアログは表示しない
      - 最終試練（elf-ultra）以外の場合はノードモードへ戻る
      - 最終試練（elf-ultra）をクリアした場合は、進行ルートに応じて『elf-bad-ending』または『elf-true-ending』へ移行し、対応するエンディングモードを再生する
    - 終了時のピクロスの状態と回答が一致してい無い場合
      - 一致していない場合は「Failed」と表示しする
      - ゲームオーバーモードに移行する

### ピクロスクリアーモード

- 概要
  - ピクロス勝利後に表示する勝利演出モード。
  - HEROの勝利メッセージとポートレートを表示し、Continueで次のモードへ遷移する。
- 表示
  - HEROポートレート
    - フレーム：幅380px × 高さ487px（会話モードの表示枠と同値）。
    - ブラウザ幅768px以下の場合は幅300px、480px以下の場合は幅240pxを上限とし、縦横比は維持する。
    - フレーム内で画像は object-fit: cover で表示しつつ、カード中央に水平・垂直方向ともセンタリングする。
    - ポートレート背面のグロー演出はフレームにフィットさせ、余白が左右対称になるよう調整する。
  - 勝利タイトル
    - テキスト：`<HERO_NAME> Win` を中央揃えで表示する。
  - Continueボタン
    - 勝利タイトルの下に配置し、中央揃えで表示する。
- 操作
  - **Continue** ボタンで次モードへ遷移する。
  - Enter / Space キーでも Continue をトリガーできるようにする。

### ゲームオーバーモード

- 概要
  ゲームオーバーを示し、ゲームオーバー後の行動予定を決める

### エンディングモード

- 概要
  - ピクロス最終試練（elf-ultra）をクリアした後、到達ルートに応じたエンディングを表示するモード。
  - ストーリーテキストを下から上へゆっくりスクロールし、「FIN」を表示した後にスタッフロールを流す。
- 背景
  - エンディング専用背景画像を表示する。
    - ファイル：assets/img/background/ending.png
- BGM
  - エンディングモードでは `assets/bgm/indie-game-pix-ending.wav` をループ再生し、遷移時には他モードの楽曲から約400msでクロスフェードする
- 画面
  - エンディング種別
    - bad-ending ルート：グリモワールの力を制し切れず、森に眠る光が一時的に失われた結末を描写する。
    - true-ending ルート：${HERO_NAME} が elfpix の守護者として認められ、新たな旅路へ進む結末を描写する。
  - ストーリーテキスト表示フェーズ
    - 表示テキスト（例）
      - bad-ending：
        - "試練の灯火は揺らぎ、${HERO_NAME}は森の悲嘆を背負うこととなった。"
        - "けれど立ち止まらない。失った光を取り戻す旅が、ここから始まる。"
      - true-ending：
        - "こうして最終試練を乗り越えた${HERO_NAME}は、elpixに認められることとなった"
        - "新しいelfpixを探す${HERO_NAME}の旅はまだ続く。"
    - 表示効果
      - テキストは下から上へゆっくりスクロールさせる。
      - スクロール開始時は下で薄く表示し、中央付近で文字をはっきり表示、上に抜ける際に再び薄くする。
      - フォント：kawaii font
  - フィナーレ表示フェーズ
    - 「FIN」を画面中央に大きく表示する。
    - 「FIN」の下部に "Thank you for playing" を表示する。
    - 背景はストーリーテキストと同じエンディング背景を継続表示する。
    - フォント：kawaii font
  - スタッフロールフェーズ
    - 表示内容
      - サウンドデザイン：by ino9
      - イラスト：by Stable Diffusion Automatic
      - シナリオデザイン：by ChatGPT/gpt-5
      - プログラマー：by ChatGPT/codex-gpt-5
    - 表示効果
      - 左側からスクロールインさせ、中央で約2秒停止後、右側へスクロールアウトする。
      - フォント：kawaii font
- 遷移
  - スタッフロールの表示が完了したらタイトル画面へ遷移する。

- 画面
  - 初期表示画面
    - **Continue** ボタン
    - **Quit** ボタン
    - 背景画像
      - assets/img/\* からランダムな画像を背景に表示
- 操作
  - **Continue** ボタンを押下
    - 再度、同じキャラクター・ノードに挑戦できる
    - ゲームの時間を20分に戻す
    - BGMはバトル用へ戻す
  - **Quit** ボタンを押下
    - ゲームオーバー演出を閉じ、オープニングモードへ遷移する
    - オープニングテーマ（assets/bgm/indie-game-pix-opening.wav）を再生状態に戻し、ヘッダートグル表示もオンに統一する

### 共通

- 画面
  - 「サウンド」ボタンを配置
    - 表示値
      - 「BGM」
      - 再生状態は文字として表示しない
      - 文字の色：黒
    - ボタンのスタイル
      - サウンド再生状態：はい
        - ボタンの色：グリーン
      - サウンド再生状態：いいえ
        - ボタンの色：灰色
- 内部データ
  - サウンドステータスは `localStorage.soundOn` で管理し、`"1"` をオン、`"0"` をオフとして扱う
  - 初回表示（プロローグ開始時）はステータスを強制的にオンへ更新し、BGMを再生開始する
  - プロローグ以外のモードでは画面遷移で強制的にオンへ戻さず、プレイヤーの操作のみで状態が変化する
- 操作
  - 「サウンド」ボタン押下
    - サウンド再生状態がfalseの場合
      - サウンドオン
      - audioタグを用いて、assets/wav/\*
        からランダムな音楽を再生
    - サウンド再生状態がtrueの場合
      - サウンドオフ
    - サウンドオン状態
      - バックグラウンドで再生され続ける
      - 画面遷移しても再生され続ける
    - サウンドオフ状態
      - すべてのモードでBGMの再生を停止したまま維持し、プレイヤーが再度オンにするまで再生を再開しない

### Game sound

#### Sound Effect

- 塗った場合は、筆で塗った時のような音を鳴らします。
- 「保留」「×」等可能性のあるマークを塗るときは、別の音をならします。

## タスク仕様（Improvement/normal）

- 名前決定モード終了後に、遷移元の画面に戻り、会話の続きから再開する。
- 会話の続きで、入力した主人公名（${HERO_NAME}）を利用・表示する。
- 名前決定モードと会話モードのウィンドウを以下に統一:
  - ウィンドウ背景：青色（#1e3a8a）
  - ウィンドウ枠：金色（#d1b464）
  - 文字色：白（必要に応じて）

## タスク仕様（Fix/high）

- BGMのオンオフができなくなっているので修正
  - プロローグ開始時はBGMステータスを自動的にオンへ切り替え、ヘッダーのトグル表示もオン状態にする
  - プロローグ以外のモードではBGMトグルの状態を画面遷移で書き換えず、プレイヤー操作のみで切り替える
  - BGMトグルの状態をlocalStorageに保持し、オフ状態ではBGM再生を停止したまま維持する
  - 「New Game」操作時は既存仕様通りBGMステータスをオンに戻し、BGMを再開する
- 対戦モードで、スペル発動時の台詞は各キャラクターが唱えたスペルは、キャラクター画像の右側に吹き出しで表示する
  - HEROのスペル詠唱時は`${HERO_NAME}`が叫ぶフレーバーテキストを吹き出しに表示する
  - ENEMYのスペルはスペルIDごとに設定した専用台詞を吹き出しに表示する
  - 吹き出しは発動からおよそ4秒でフェードアウトし、再度スペルが発動した場合は内容を更新する
- 会話モードの時の背景画像をENEMYの画像に差し替える
  - 会話モード開始時に、その会話で対峙している敵キャラクターの全身イラストを背景に表示する
  - 対応する画像が存在しない場合のみ、従来のランダム背景にフォールバックする
- 会話モードのキャラクターの表示サイズを、従来の1.5倍表示を基準に縦横とも約75%へ縮小する
  - 最大表示幅の目安を約428px（高さ約548px）とし、キャラクターごとに同一スケールで描画する
  - 比率は維持しつつ、画面幅が狭い場合は従来通りレスポンシブに縮小し、左右の余白確保を優先する
- バトルモードの背景画像をENEMYの画像に差し替える
  - ピクロス（バトル）モード中は、対峙する敵キャラクターの全身イラストを背景に表示する
  - 全身イラストが存在しない場合は従来の背景ローテーションへフォールバックする
