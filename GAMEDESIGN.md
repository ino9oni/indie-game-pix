# Role
- あなたは、ゲームデザイナ兼プログラマ兼コンポーザーAIアシスタントです。

# Purpose
- ピクロスゲームを作成します。

# Requirements and Specification

## Requirements
- 画面はスタイリッシュでカラフルで、シズル感のあるUIにします。
- 基本的なゲームのルールは一般的なピクロスゲームに従います。
- UIにはReactを使い、Web画面で提供します。

## Gamed design and specification

### Game Title
- elfpix

### Game system

#### プロローグ

- 概要
    - プロローグを表示する
- 画面表示
    - 背景画面 
        - 黒背景
    - プロローグ表示画面
        - ウィンドウ背景：青色
        - ウィンドウ枠：金色
        - 文字：白色
        - テキスト
            - 森深くに隠されたエルフの集落には、
            - 古から伝わる知恵遊び「elfpix」が存在した。
            - 
            - これは、森に宿る精霊の力を象った図形を浮かび上がらせる、
            まるでピクロスのような試練。
            - [ENTER]
            - 
            - エルフは、森に迷い込んだ者にこの「elfpix」を課し、
            - 正しく解き明かした者だけが先へ進むことが許された。
            - 
        - テキストの表示
            - うっすらとテキストを順番に表示する
            - 空文字は空行として表示する
        - 入力
            - [ENTER] キーの入力 または 画面クリック すると次の行が表示される
        - 自動
            - テキストがすべて表示されたあと、2秒待つ
            - **オープニング** に移行

#### オープニング

- 概要
    - 概要
        ゲーム開始・コンティニューを選択できる。
    - 内部情報
        - タイトル
            - elfpix
            - フォント：かわいいフォント
        - 背景
            - タイトル背景として固定画像を表示する
                - ファイル：assets/img/title.png
                - 画像サイズ：1536 x 768
    - 画面
        - タイトル画面
        - 「**New Game**」ボタンを表示する
            - **New Game** を押下した場合
                - 今までのプレイデータをクリアする。
                    - ピクロスのプレイ履歴データを消去する。
                        - 履歴データ
                            - 主人公のルート上の位置
                            - クリア済みのノード
                - 確認ダイアログなしで即時実行する。
                - **ゲーム開始** へ遷移する。
            - **Continue** を押下した場合
        - 「**Continue**」ボタン、を表示する
            - **Continue** を押下した場合
                - 今までのプレイデータをロードする。
                    - プレイデータ
                        - 主人公のルート上の位置
                        - クリア済みのノード
                - **ゲーム開始モード** へ遷移する。

#### ゲーム開始モード

- 会話ウィンドウを表示
    - 画面 
        - ウィンドウ背景：青色
        - ウィンドウ枠：金色
    - テキスト
        - ここに一人の人間の若き旅人がいた。[Enter]
        - その名を…[Enter]
        - 会話ウィンドウ閉じる
            - """名前決定モード"""へ移動、名前決定後に、後ほど""ゲーム開始モード""に戻る
        - その名を「${HERO_NAME}」といった。
        - 森の奥に眠る「古代の泉」にたどり着くために、エルフの森へ足を踏み入れようとしていた。
        - しかし、エルフの守り人たちから「elfpix」の挑戦を突きつけられてしまう。
        - 主人公の知恵と洞察力が、森を抜けて、古代の泉に唯一の鍵となる…。

#### 名前決定モード

- 概要
  - 名前入力画面を開き、名前入力を行う。
  - ここで決定した名前は、以降「${HERO_NAME}」として表示された箇所の具体値として利用される

- 画面
    - カタカナを横書きで並べてある
        - 右上から縦書き
        - レイアウト
            - 文字
                - 横：10 x 縦：5
                - 文字種とレイアウト詳細：
                    |アイウエオ|　|ハヒフヘホ|　|ァィゥェォ|　|％＆（）＠|
                    |カキクケコ|　|マミムメモ|　|ヵヶッャュ|　|　　　　　|
                    |サシスセソ|　|ヤ　ユ　ヨ|　|ョヮ０１２|　|　　　　　|
                    |タチツテト|　|ワ　　　ヲ|　|３４５６７|　|　　　　　|
                    |ナニヌネノ|　|ン　　　　|　|８９！＃＄|　|　　　　　|
                　　｜[一文字削除][←][→][決定]　|　　　　　|　|　　　　　|
                - "　"は空白とする
                - "|" は枠線とする
                - レイアウトは５文字ずつ揃える
    - 背景画像
        - assets/img/* からランダムな画像を背景に表示
            - 透明度：60%
- 操作
    - 決定ボタン
        - 主人公の名前を"入力値"とする
          以降$${HERO_NAME}に、"入力値"を保存する
        - 名前入力画面を閉じる
    - 取り消しボタン
        - 文字を一文字削除する
        - １文字入力を戻す

#### ルートモード

- 概要
    - 主人公の旅路と現在値を示し、選択したルート上にあるノードにいるelfとピクロスバトルとなる。
    - そのルート上のどこに現在位置しており、どのように進行をするかを決定／見える化するためのモード。

- 内部データ表現
    - ルートにはノードとエッジがある。
    - ノード
        - ルート開始場所。
        - ルート修了場所。
        - エルフと遭遇する場所。
        - エルフと会話して、ピクロスバトルが開始される。
        - ピクロスモードに遷移する。ピクロスモード終了後にここに戻る。
    - ルート
        - ノードとノードをつなぐもの。
        - ノード同士にルートがある個所は、ノードを行き来可能
    - ルートとノードの表現
        - 以下のルートとノードを定義。このルートとノードを線と点でつなぐ
            - node:start
                - node: elf-practice
                    - node: elf-easy
                        - node: elf-middle
                            - node: ending-middle
                            - node: elf-hard
                        - node: elf-hard
                            - node: ending-hard
    - 現在地
        - 主人公が現在いる位置を示す
- 画面
    - ルートとノードが画面に表示されている
    - 主人公のノードの現在値に、デフォルメキャラを表示する
        - 画像
            - assets/img/character/hero/00083-826608146.pngを 表示
            - 縦：60px
            - 横：20px
    - 開始のノード位置に、スタート位置がわかるような画像を表示する
    - 終了のノード位置に、終了位置がわかるような画像を表示する
    - ルートは一本道の表現ではなく、気持ち曲がりくねったような形で道らしい表現で表示する
    - 背景画像
        - assets/img/* からランダムな画像を背景に表示
            - 透明度：60%
    - ノード
        - ノードの真下にテキストボックスを表示
            - テキストボックス内にノードの名称を表示
            - テキストボックス
                - 属性
                    - 背景:白
                    - 枠：黒
                    - フォント：黒
- 操作
    - ノードをクリック
        - 会話モードへ移行し、会話終了後にピクロスモードへ移行する
        - 効果音
            - クリック時に、ざっざっざと歩くようなSEを再生する（素材は後日追加）
        - 制約
            - クリック可能なノードは、
              主人公が位置するノードから次のノードまでとする。
            - ２つ先のノードへは移動できない。
            - からなず１ノードのみとする
            - １ノード先であれば、ルートがつながっいれば
              どちらへでも移動が可能。
            - 移動したら元の位置に戻ることはできない。

#### 会話モード

- 概要
    - 敵キャラクターと主人公の会話を表現するモード。
    - ノードクリック後に本モードへ遷移し、会話完了後にピクロスモードへ遷移する。
- 背景音楽
    - assets/bgm/*（任意）をBGMとして再生（ループ可）。
- 表示
    - 主人公の画像
        - ファイル（テスト用）：青い四角のプレースホルダ画像（200px x 100px）
        - ラベル表示：${HERO_NAME}
        - レイアウト：左端（会話ウィンドウにかからない位置）
    - 敵の画像
        - ファイル（テスト用）：赤い四角のプレースホルダ画像（200px x 100px）
        - ラベル表示：${ENEMY_NAME}
        - レイアウト：右端（会話ウィンドウにかからない位置）
    - 会話のウィンドウ
        - 左上：セリフの話者の名前
        - 中央：セリフ本文
- 操作
    - クリック または Enterキーで会話を進める。
    - 「会話をスキップ」ボタンを表示する。
- 内部状態
    - 会話スクリプトを読み込み・逐次表示する。
        - practice の会話
            - START
            - No.1
                - 話者：主人公
                - 台詞："あなたは…"
                - 感情：普
            - No.2
                - 話者：敵キャラクター
                - 台詞："よくここまできたわね、あなたがelfpixに認められるにふさわしいかどうか…私が相手してあげましょう…"
                - 感情：普
            - No.3
                - 話者：敵キャラクター
                - 台詞："あなた名前は？"
                - 感情：普
            - No.4
                - 話者：主人公
                - 台詞："${HERO_NAME}と言います。"
                - 感情：普
            - No.5
                - 話者：敵キャラクター
                - 台詞："${HERO_NAME}と言うのね、いい名前ね。覚えておくわ。私は${ENEMY_NAME}というの。"
            - No.6
                - 話者：敵キャラクター
                - 台詞："では準備はいい？いくわよ。"
            - No.7
                - 話者：主人公
                - 台詞："お願いします。"
            - END
        - easy の会話：適当に生成（後ほど実装）
        - normal の会話：適当に生成（後ほど実装）
        - hard の会話：適当に生成（後ほど実装）
- 遷移
    - 会話スクリプトがENDに到達したら、ピクロスモードへ遷移する。

#### ピクロスモード

- 概要
    - ピクロスを説くモード（会話モード終了後に開始）。
    - ノードの位置別に相手キャラクターとお題（ピクロスのサイズ）が異なる
    - practice
        - ノードの対応
            - 名前:elf-practice
        - 対戦相手
            - ピクロスのサイズ
                - 5 x 5
            - 属性
                - 敵の名前：リーネ
                - 設定・キャラクター概要：練習用の相手、道先案内人。
                - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
                - 画像（怒り）：assets/img/character/enemies/practice/riene_angry.png（390 x 487）
    - easy
        - ノードとの対応
            - 名前:elf-easy
        - 対戦相手
            - ピクロスのサイズ
                - 10 x 10
            - 属性
                - 名前：エフィナ
                - 設定・キャラクター概要：森の中層で動物モチーフのパズル。
                - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
                - 画像（笑顔）：(test画像)
                - 画像（怒り）：(test画像)
    - middle
        - ノードとの対応
            - 名前: elf-middle
        - 対戦相手
            - ピクロスのサイズ
                - 15 x 15
            - 属性
                - 名前：セリス
                - 設定・キャラクター概要：奥地で古代紋章モチーフのパズル。
                - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
                - 画像（笑顔）：(test画像)
                - 画像（怒り）：(test画像)
    - hard
        - ノードとの対応
            - 名前: elf-hard
        - 対戦相手
            - ピクロスのサイズ
                - 20 x 20
            - 属性
                - 名前：フローリア
                - 設定・キャラクター概要：精霊を象るパズル、物語の核心に近づく。
                - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
                - 画像（笑顔）：(test画像)
                - 画像（怒り）：(test画像)
    - ultra
        - ノードの位置
            - elf-ultra
        - 対戦相手
            - ピクロスのサイズ
                - 25 x 25
            - 属性
                - 名前：アルティナ
                - 設定・キャラクター概要：最終試練、結末分岐。
                - 画像（通常）：(test画像)
                - 画像（笑顔）：(test画像)
                - 画像（怒り）：(test画像)

- 画面
    - 初期表示
        - 残り時間表示バー
        - ピクロス画面
            - 難易度にあわせてピクロスを表示
            - 出題は難易度ごとのパズルバンクからランダムに選択され、解は一意となるよう設計する
            - **Continue** ボタン
            - **Quit** ボタン
            - **Submit** ボタン
            - ピクロスのヒント文字列は18pt程度にする
            - ピクロスの画面は75%程度の透明度にする
            - ピクロスの画面は表示画面の上下左右から常にセンタリングする
            - ヒント文字列はピクロスの１マスサイズと等間隔で並べる
            - ヒント文字列は、行は右揃え、列は下揃えにする
        - 背景画像
            - assets/img/* からランダムな画像を背景に表示
                - 透明度：60%
- 操作
    - **Submit** を押下する
        - ピクロス終了状態へ移行する

    - **Quit** を押下する
        - ゲームオーバーモードへ移行する

- タイマー処理
    - ピクロス開始状態直後から、持ち時間が減少する
    - 0秒になった場合に、ピクロス終了状態に線にする

- 内部データ・状態
    - ピクロス開始状態
        - 初期状態は20分持ち時間がある
    - ピクロス終了状態
        - 終了時のピクロスの回答と答案が一致している場合
            - 「Mission clear！」を表示する
            - ノードモードへ移行する
        - 終了時のピクロスの状態と回答が一致してい無い場合
            - 一致していない場合は「Failed」と表示しする
            - ゲームオーバーモードに移行する

### ゲームオーバーモード

- 概要
    ゲームオーバーを示し、ゲームオーバー後の行動予定を決める

- 画面
    - 初期表示画面
        - **Continue** ボタン
        - **Quit** ボタン
        - 背景画像
            - assets/img/* からランダムな画像を背景に表示
- 操作
    - **Continue** ボタンを押下
        - 再度、同じキャラクター・ノードに挑戦できる
        - ゲームの時間を20分に戻す
    - **Quit** ボタンを押下
        - ゲームオーバーの音楽を流す
        - ゲームオーバーである旨を表示する

### 共通
- 画面
    - 「サウンド」ボタンを配置
        - 表示値
            - 「BGM」
            - 再生状態は文字として表示しない
            - 文字の色：黒
        - ボタンのスタイル
            - サウンド再生状態：はい
                - ボタンの色：グリーン
            - サウンド再生状態：いいえ
                - ボタンの色：灰色
- 内部データ
    - デフォルト：サウンドオフ
- 操作
    - 「サウンド」ボタン押下
        - サウンド再生状態がfalseの場合
            - サウンドオン
            - audioタグを用いて、assets/wav/*
              からランダムな音楽を再生
        - サウンド再生状態がtrueの場合
            - サウンドオフ
        - サウンドオン状態
            - バックグラウンドで再生され続ける
            - 画面遷移しても再生され続ける    

### Game sound
#### Sound Effect

- 塗った場合は、筆で塗った時のような音を鳴らします。
- 「保留」「×」等可能性のあるマークを塗るときは、別の音をならします。

## タスク仕様（Improvement/normal）
- 名前決定モード終了後に、遷移元の画面に戻り、会話の続きから再開する。
- 会話の続きで、入力した主人公名（${HERO_NAME}）を利用・表示する。
- 名前決定モードと会話モードのウィンドウを以下に統一:
  - ウィンドウ背景：青色（#1e3a8a）
  - ウィンドウ枠：金色（#d1b464）
  - 文字色：白（必要に応じて）
