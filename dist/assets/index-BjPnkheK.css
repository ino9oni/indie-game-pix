:root{--bg: #070a12;--panel: #0f1220cc;--text: #e5e7eb;--muted: #9ca3af;--brand: #7c3aed;--brand-2: #22d3ee;--accent: #f59e0b;--ok: #22c55e;--bad: #ef4444;--cell: 32px;--font-scale: 1.5}*{box-sizing:border-box}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}html,body,#root{height:100%}body{margin:0;color:var(--text);font-size:calc(16px * var(--font-scale));background:radial-gradient(1200px 800px at 80% -20%,#1f1147 0%,transparent 60%),radial-gradient(1000px 700px at -10% 120%,#0b5b63 0%,transparent 50%),linear-gradient(180deg,#0a0f1b,#070a12);font-family:"M PLUS Rounded 1c",Hiragino Maru Gothic ProN,"Rounded Mplus 1c",Yu Gothic UI,Quicksand,ui-rounded,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,Arial,"Apple Color Emoji","Segoe UI Emoji",sans-serif}.app{position:relative;z-index:0;min-height:100vh;display:flex;flex-direction:column}.bg-image{position:fixed;top:0;right:0;bottom:0;left:0;z-index:-1;background-size:contain;background-position:center;background-repeat:no-repeat;opacity:.6;filter:saturate(1.05) contrast(1.05) brightness(.9)}.bg-image:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:radial-gradient(1200px 800px at 80% -20%,#1f114780 0%,transparent 60%),radial-gradient(1000px 700px at -10% 120%,#0b5b6380 0%,transparent 50%)}.app-header{display:flex;justify-content:space-between;align-items:flex-start;padding:16px 20px}.brand{display:flex;align-items:center;gap:10px}.brand-stack{display:flex;flex-direction:column;gap:6px}.logo{color:var(--brand-2);font-size:calc(24px * var(--font-scale));filter:drop-shadow(0 0 8px #22d3ee80)}.title{font-weight:800;letter-spacing:.5px}.top-actions{display:flex;align-items:center;gap:10px}.conversation-stage{display:flex;justify-content:space-between;align-items:flex-start;gap:clamp(20px,5vw,64px);padding:clamp(12px,4vw,48px) clamp(16px,6vw,72px) 0;width:100%}.conversation-slot{flex:1 1 0;display:flex;flex-direction:column;align-items:center;gap:8px}.conversation-slot.hero{align-items:flex-start}.conversation-slot.enemy{align-items:flex-end}.portrait-frame{position:relative;background:#1e3a8a;border:3px solid #d1b464;border-radius:12px;padding:4px;display:grid;place-items:center;overflow:hidden;flex-shrink:0;transition:box-shadow .32s ease}.portrait-frame.enemy{background:#3f1a57}.portrait-image{width:100%;height:100%;object-fit:cover;object-position:center;display:block;transition:opacity .26s ease,transform .36s cubic-bezier(.34,1.56,.64,1),filter .36s ease}.portrait-label{min-width:120px;text-align:center;font-size:calc(16px * var(--font-scale));letter-spacing:.04em;transition:opacity .24s ease,transform .24s ease}.portrait-placeholder{background:#dc2626;border-radius:12px;padding:12px 16px;font-weight:800;color:#fff}@media (max-width: 960px){.conversation-stage{gap:clamp(16px,4vw,48px);padding:clamp(12px,3vw,32px) 24px 0}.conversation-slot{flex:1 1 50%}}@media (max-width: 640px){.conversation-stage{flex-direction:column;align-items:center;padding:16px 20px 0}.conversation-slot,.conversation-slot.hero,.conversation-slot.enemy{align-items:center}}.score-hud{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;min-height:36px;border-radius:10px;border:1px solid rgba(250,204,21,.45);background:#20180861;color:#fde68a;font-size:calc(14px * var(--font-scale));font-weight:600;letter-spacing:.04em;transition:transform .16s ease,box-shadow .16s ease,filter .16s ease}.score-hud.animating{transform:translateY(-1px) scale(1.01);box-shadow:0 12px 28px #facc1547;filter:drop-shadow(0 0 10px rgba(250,204,21,.32))}.score-label{font-size:calc(12px * var(--font-scale));text-transform:uppercase;letter-spacing:.12em;color:#fde68a}.score-value{font-family:Share Tech Mono,Fira Mono,Menlo,monospace;font-size:calc(18px * var(--font-scale));font-weight:700;letter-spacing:1px;color:#fff7d6}.font-scale-group{display:inline-flex;align-items:center;gap:6px;padding:4px 6px;border-radius:999px;background:#0f12208c;box-shadow:0 0 12px #11182759;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.font-scale-group .ghost{min-width:58px;padding:6px 10px;font-weight:600;transition:color .16s ease,background .16s ease,border-color .16s ease,opacity .16s ease}.font-scale-group .ghost.active{background:#7c3aed38;border-color:#7c3aed99;color:var(--brand-2);opacity:1}.top-actions .ghost{opacity:.8}.screen{margin:0 auto;max-width:980px;padding:12px 20px 40px;width:100%;flex:1}.headline{font-size:calc(28px * var(--font-scale));margin:16px 0 12px}.subheadline{font-size:calc(18px * var(--font-scale));margin:0;opacity:.9}.sub{color:var(--muted);margin-top:6px}.level-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:12px}.level-card{background:linear-gradient(135deg,#0c1226,#131a3a);border:1px solid #2b2f55;color:var(--text);padding:18px;text-align:left;border-radius:14px;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}.level-card:hover{transform:translateY(-2px);box-shadow:0 10px 30px #0006,inset 0 0 0 1px #7c3aed44}.badge{display:inline-block;font-weight:800;letter-spacing:1px}.badge-easy{color:#22c55e}.badge-middle{color:#f59e0b}.badge-high{color:#f43f5e}.progress{margin-top:8px;color:var(--muted)}.toolbar{display:flex;align-items:center;gap:12px}.puzzle-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-top:16px}.puzzle-card{position:relative;background:linear-gradient(135deg,#0c1226,#161f44);border:1px solid #2b2f55;border-radius:12px;padding:16px;text-align:left;cursor:pointer}.puzzle-card .chip{position:absolute;top:8px;right:8px;background:#22c55e22;color:#22c55e;border:1px solid #22c55e66;border-radius:999px;padding:2px 8px;font-size:calc(12px * var(--font-scale))}.puzzle-card.cleared{outline:2px solid #22c55e88}.index{font-weight:700;color:var(--muted)}.game-screen{display:grid;gap:16px;grid-template-rows:auto minmax(0,1fr);flex:1;min-height:0}.game-topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.game-center{display:grid;grid-template-rows:minmax(0,1fr) auto;justify-items:center;align-items:center;align-content:center;padding-bottom:20px;position:relative;width:100%;height:100%}.hud{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--panel);border:1px solid #2b2f55;border-radius:12px;padding:10px 12px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.hud-actions{display:flex;gap:8px}.timer .time{font-weight:800;letter-spacing:1px}.timer .bar{width:240px;height:8px;background:#ffffff1a;border-radius:999px;overflow:hidden}.timer .fill{height:100%;background:linear-gradient(90deg,#22d3ee,#7c3aed);box-shadow:0 0 16px #22d3ee66}.puzzle-progress{margin-top:6px;font-size:.9rem;color:#c7d2fe;letter-spacing:.02em}.board-wrap{display:grid;gap:12px;position:relative}.board-frame{position:relative;display:flex;justify-content:center;width:auto}.board-frame>.board-wrap,.board-frame>.enemy-board{width:max-content;max-width:100%;width:-moz-fit-content;width:fit-content}.board-portrait{margin:0;position:absolute;top:18px;left:18px;transform:translate(-28%,-38%);padding:8px;border-radius:18px;border:1px solid rgba(129,140,248,.55);background:linear-gradient(135deg,#0c1329eb,#1e2952e0);box-shadow:0 18px 36px #080d238c;pointer-events:none;z-index:6;display:inline-flex}.board-portrait img{display:block;height:100px;width:auto;border-radius:12px;border:1px solid rgba(191,219,254,.55);box-shadow:0 14px 28px #0f172a8c}.board-portrait.enemy{border-color:#f8717194;background:linear-gradient(135deg,#201526eb,#3f141fe0);box-shadow:0 20px 40px #3f122485}@media (max-width: 960px){.board-portrait{transform:translate(0);top:12px;left:12px;background:linear-gradient(135deg,#0c1329e0,#1e2952d1)}}.board{display:grid;grid-template-columns:auto max-content;grid-template-rows:auto max-content;gap:0;align-items:start}.clues{display:contents}.clues .corner{grid-column:1;grid-row:1;width:100%;height:100%}.clues .top{grid-column:2;grid-row:1;display:grid;gap:2px}.clues .left{grid-column:1;grid-row:2;display:grid;gap:2px}.row-clue,.col-clue{color:#a5b4fc;opacity:.9;font-size:calc((var(--cell) * .56) * var(--font-scale));display:grid;place-items:center}.row-clue{grid-auto-flow:column;grid-auto-columns:var(--cell);justify-content:end;align-items:center;padding-right:6px;text-align:right}.col-clue{grid-auto-rows:var(--cell);justify-items:center;align-content:end;padding-bottom:6px;text-align:center}.clue-hidden{visibility:hidden}.clue-locked span{letter-spacing:.12em}.grid{grid-column:2;grid-row:2;display:grid;gap:2px;background:linear-gradient(135deg,#182044d1,#241444c2);padding:8px;border-radius:12px;border:1px solid rgba(76,81,191,.4);box-shadow:inset 0 0 24px #20286052}.cell{width:var(--cell);height:var(--cell);border-radius:8px;background:#0e153061;border:1px solid rgba(148,163,255,.88);box-shadow:0 0 0 1px #1f2f6f6b;cursor:pointer;position:relative;transition:background .12s ease,transform 60ms ease,opacity .12s ease,filter .12s ease}.cell:hover{transform:translateY(-1px);filter:saturate(1.1)}.cell.cursor{outline:3px solid #facc15;outline-offset:-3px;box-shadow:0 0 14px #facc1573,0 0 0 1px #1f2f6f8f}.cell.faded{opacity:.4}.cell.filled{background:conic-gradient(from 180deg at 50% 50%,#22d3ee66,#7c3aed66,#22d3ee66);border-color:#94a3ffeb;box-shadow:inset 0 0 10px #ffffff40,0 4px 20px #7c3aed33,0 0 0 1px #1f2f6f8f}.cell.x:after{content:"Ã—";position:absolute;top:0;right:0;bottom:0;left:0;color:#94a3b8;display:grid;place-items:center;font-weight:800;font-size:calc(18px * var(--font-scale));opacity:.7}.cell.maybe:after{content:"?";position:absolute;top:0;right:0;bottom:0;left:0;color:#f59e0b;display:grid;place-items:center;font-weight:800;font-size:calc(16px * var(--font-scale));opacity:.75}.board{opacity:.75}.battle-panels{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:24px;width:100%;align-items:stretch;align-self:center}@keyframes projectileHero{0%{transform:translate(-220%,-40%) scale(.35) rotate(-10deg);opacity:0}15%{opacity:1}70%{opacity:1}to{transform:translate(360%,-65%) scale(1.05) rotate(12deg);opacity:0}}@keyframes projectileEnemy{0%{transform:translate(220%,-40%) scale(.35) rotate(6deg);opacity:0}15%{opacity:1}70%{opacity:1}to{transform:translate(-360%,-60%) scale(1) rotate(-12deg);opacity:0}}.spell-projectiles{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none;overflow:hidden;z-index:8}.spell-projectile{position:absolute;width:18px;height:18px;border-radius:50%;filter:drop-shadow(0 0 8px rgba(255,255,255,.65));opacity:0}.spell-projectile.hero{top:52%;left:24%;background:radial-gradient(circle at 35% 35%,#c4f1ff,#60a5fa 38%,#3b82f614 75%);box-shadow:0 0 24px #3b82f699;animation:projectileHero 1s ease-out forwards}.spell-projectile.enemy{top:48%;right:24%;background:radial-gradient(circle at 35% 35%,#fecaca,#f87171 40%,#dc26261a 78%);box-shadow:0 0 24px #f87171a6;animation:projectileEnemy 1s ease-out forwards}@media (max-width: 960px){.battle-panels{grid-template-columns:1fr}.player-panel,.enemy-panel{grid-template-columns:1fr;grid-template-areas:"avatar" "spell" "score" "board" "progress"}.panel-avatar,.panel-score{justify-self:center;text-align:center}.panel-avatar{justify-content:center}.panel-score{width:100%;min-height:auto;padding:12px;align-items:center;justify-content:center;gap:4px}.panel-spell{width:100%;flex-direction:column;align-items:flex-start;gap:8px}.score-meter{width:100%;flex-direction:row;align-items:center;justify-content:space-between;min-width:0;padding:10px 12px}.score-value{font-size:1.1rem}.combo-badge{right:16px;bottom:8px}.spell-projectile.hero{left:50%;top:34%;right:auto;animation:projectileHeroStack 1s ease-out forwards}.spell-projectile.enemy{left:50%;top:74%;right:auto;animation:projectileEnemyStack 1s ease-out forwards}}@media (max-width: 768px){.spell-slot{align-items:flex-start;flex-wrap:wrap;gap:8px}.combo-badge{position:static;display:flex;align-items:center;justify-content:center;width:100%;margin-top:4px;transform:scale(.94)}.combo-badge.visible{transform:scale(1)}}@keyframes projectileHeroStack{0%{transform:translate(-50%,-200%) scale(.35);opacity:0}15%{opacity:1}70%{opacity:1}to{transform:translate(-50%,200%) scale(1.05);opacity:0}}@keyframes projectileEnemyStack{0%{transform:translate(-50%,200%) scale(.35);opacity:0}15%{opacity:1}70%{opacity:1}to{transform:translate(-50%,-200%) scale(1.05);opacity:0}}.player-panel,.enemy-panel{display:grid;grid-template-columns:auto minmax(0,1fr) auto;grid-template-areas:"avatar spell score" "board board board" "progress progress progress";gap:12px 16px;align-items:start;grid-template-rows:auto auto minmax(0,1fr) auto;height:100%}.panel-avatar{grid-area:avatar;display:flex;align-items:center;position:relative}.panel-avatar img{width:72px;height:72px;object-fit:cover;border-radius:16px;border:2px solid rgba(148,163,255,.55);box-shadow:0 10px 18px #0f172a59;background:#0f172ad1}.panel-avatar-placeholder{display:inline-flex;width:72px;height:72px;border-radius:16px;align-items:center;justify-content:center;background:#111827b3;border:1px dashed rgba(148,163,255,.4);color:var(--muted);font-weight:600}.panel-avatar.hero img{border-color:#60a5faa6}.panel-avatar.enemy img{border-color:#f87171b3}.enemy-panel .panel-avatar-placeholder{border-color:#f8717166;color:#f87171a6}.spell-speech{position:absolute;top:50%;left:calc(100% + 12px);transform:translateY(-50%);min-width:180px;max-width:240px;padding:8px 12px;border-radius:14px;border:1px solid rgba(148,163,255,.45);color:#f8fafc;background:#1e293be6;box-shadow:0 14px 28px #0f172a73;pointer-events:none;z-index:4;animation:speechFade .16s ease-out both}.spell-speech.hero{border-color:#60a5fa8c;background:#1e3a8ae6}.spell-speech.enemy{border-color:#f8717199;background:#7f1d1de0}.spell-speech:before{content:"";position:absolute;top:50%;left:-10px;transform:translateY(-50%);width:0;height:0;border-style:solid;border-width:10px 10px 10px 0}.spell-speech.hero:before{border-color:transparent rgba(30,58,138,.9) transparent transparent}.spell-speech.enemy:before{border-color:transparent rgba(127,29,29,.88) transparent transparent}.spell-speech-text{display:block;font-size:.9rem;line-height:1.4;font-weight:600;letter-spacing:.01em}@keyframes speechFade{0%{opacity:0}to{opacity:1}}@media (max-width: 768px){.spell-speech{top:calc(100% + 10px);left:0;transform:none;max-width:min(270px,70vw)}.spell-speech:before{top:-10px;left:18px;transform:none;border-width:0 10px 10px 10px}.spell-speech.hero:before{border-color:transparent transparent rgba(30,58,138,.9) transparent}.spell-speech.enemy:before{border-color:transparent transparent rgba(127,29,29,.88) transparent}}.panel-spell{grid-area:spell;display:flex;align-items:stretch;justify-content:space-between;gap:12px}.spell-slot{width:100%;min-height:76px;border-radius:14px;border:1px solid #2b2f55;background:#11163aad;padding:8px 12px;display:flex;align-items:center;gap:12px;transition:border-color .2s ease,box-shadow .2s ease;position:relative}.spell-slot.hero{border-color:#60a5fa9e}.spell-slot.enemy{border-color:#f871719e}.spell-slot.active.hero{box-shadow:0 0 24px #3b82f640}.spell-slot.active.enemy{box-shadow:0 0 24px #f8717140}.spell-slot img{width:56px;height:56px;object-fit:cover;border-radius:12px;border:2px solid rgba(148,163,255,.4)}.spell-slot-wrapper{flex:1 1 auto;display:flex;align-items:center}.score-meter{align-self:stretch;min-width:120px;padding:10px 14px;border-radius:12px;border:1px solid rgba(148,163,255,.45);background:#0f172aad;box-shadow:inset 0 0 24px #0f172a59;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;gap:4px}.score-meter.hero{border-color:#60a5faa6;background:linear-gradient(135deg,#1e3a8ad9,#3b82f659);color:#e0f2fe}.score-meter.enemy{border-color:#f8717199;background:linear-gradient(135deg,#7f1d1dd9,#fb71854d);color:#fee2e2}.score-label{font-size:.72rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;opacity:.85}.score-value{font-size:1.35rem;font-weight:700;line-height:1.1}.spell-slot.enemy img{border-color:#f8717180}.spell-slot-text{display:flex;flex-direction:column;gap:2px}.spell-slot-name{font-weight:700;font-size:.95rem;letter-spacing:.02em}.spell-slot-desc{font-size:.8rem;opacity:.85}.spell-slot-placeholder{font-size:.85rem;color:var(--muted);letter-spacing:.04em}.combo-badge{position:absolute;right:12px;bottom:10px;padding:6px 12px;border-radius:999px;font-size:.8rem;font-weight:700;letter-spacing:.05em;text-transform:uppercase;opacity:0;transform:translateY(6px) scale(.92);pointer-events:none;transition:opacity .2s ease,transform .18s ease;box-shadow:0 0 12px #0ea5e940}.combo-badge.hero{background:linear-gradient(135deg,#4cb5ffeb,#0e74e3d1);color:#e0f2fe}.combo-badge.enemy{background:linear-gradient(135deg,#ff6262eb,#dc2626d1);color:#fee2e2;box-shadow:0 0 12px #dc262640}.combo-badge.visible{opacity:1;transform:translateY(0) scale(1)}.combo-badge-text{display:inline-block;animation:comboPulse .18s ease-out forwards}@keyframes comboPulse{0%{transform:scale(.88)}60%{transform:scale(1.12)}to{transform:scale(1)}}.panel-score{grid-area:score;justify-self:end;align-self:stretch;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;background:#0f172ac7;border:1px solid #2b2f55;border-radius:14px;padding:8px 14px;min-width:120px;min-height:76px;gap:2px}.panel-score.hero{border-color:#60a5fa8c;color:#cbd5ff}.panel-score.enemy{border-color:#f871718c;background:#311424c7;color:#fecaca}.panel-score-label{font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;opacity:.8}.panel-score-value{font-size:2rem;line-height:1;font-weight:800}.panel-score-sub{font-size:.85rem;opacity:.8}.panel-board{grid-area:board;display:flex;justify-content:center;align-items:center}.panel-progress{grid-area:progress;display:flex;align-items:center}.panel-progress .progress-track{width:100%}.progress-track{width:100%;height:8px;border-radius:999px;background:#11163a;overflow:hidden;box-shadow:inset 0 0 0 1px #2b2f55}.progress-track.enemy{background:#2a173e}.progress-fill{height:100%;background:linear-gradient(90deg,#34d399,#22d3ee);transition:width .16s ease}.progress-track.enemy .progress-fill{background:linear-gradient(90deg,#f97316,#ef4444)}.enemy-board{display:grid;grid-template-columns:auto max-content;grid-template-rows:auto max-content;gap:0;align-items:start;opacity:.75}.enemy-board .grid{padding:8px;background:linear-gradient(135deg,#401220d1,#2e0c17c7);border:1px solid rgba(127,29,29,.42);box-shadow:inset 0 0 22px #7f1d1d47}.enemy-board .cell{cursor:default;border-radius:6px;background:#28111b5c;border:1px solid rgba(248,113,113,.82);box-shadow:0 0 0 1px #7f1d1d75;transition:background .12s ease,opacity .12s ease,filter .12s ease}.enemy-board .cell:hover{filter:saturate(1.1)}.enemy-board .cell.filled,.enemy-board .cell{border-radius:6px}.enemy-board .cell.filled{background:linear-gradient(135deg,#f97316,#fb7185);border-color:#f8adade6;box-shadow:inset 0 0 10px #f59e0b80,0 0 0 1px #7f1d1d94}.enemy-board .cell.cursor{box-shadow:0 0 14px #f8717173,0 0 0 1px #7f1d1d94}.spell-log{margin-top:16px;min-height:48px;background:#111634cc;border:1px solid #312e81;border-radius:12px;padding:12px 16px;color:#c7d2fe;font-size:.85rem;display:grid;gap:4px}.spell-log li{list-style:none}.pause-overlay{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;background:#070a1299;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);z-index:7;pointer-events:all}.pause-box{background:#0f172acc;border:1px solid #2563eb;border-radius:16px;padding:28px 40px;text-align:center;color:#e0edff;box-shadow:0 24px 48px #03081780;min-width:240px}.pause-title{font-size:1.6rem;font-weight:700;letter-spacing:.04em;margin-bottom:18px}.pause-actions{display:flex;justify-content:center;gap:12px}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);background:#0009;display:grid;place-items:center}.modal{background:#0c1226;border:1px solid #2b2f55;padding:20px;border-radius:14px;max-width:420px;width:calc(100% - 32px)}.particle-overlay{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none;overflow:visible}.particle-flare{position:absolute;width:26px;height:26px;margin-left:-13px;margin-top:-13px;background:radial-gradient(circle,rgba(255,255,255,.95) 0%,rgba(224,231,255,.35) 55%,transparent 80%);mix-blend-mode:screen;animation:particleFlare .22s ease-out forwards;pointer-events:none}.particle-burst{position:absolute;width:14px;height:14px;margin-left:-7px;margin-top:-7px;background:radial-gradient(circle,rgba(236,233,254,.95) 0%,rgba(94,234,212,.25) 50%,transparent 94%);animation:particleBurstFade .82s cubic-bezier(.18,.66,.35,1) forwards;box-shadow:0 0 18px #f4f4ffe6}.particle-burst:after{content:"";position:absolute;top:-12px;right:-12px;bottom:-12px;left:-12px;border-radius:999px;border:2px solid rgba(251,191,36,.45);opacity:.6;animation:particleRing .84s ease-out forwards}.particle-shockwave{position:absolute;width:14px;height:14px;margin-left:-7px;margin-top:-7px;border:2px solid rgba(244,244,255,.4);border-radius:999px;animation:particleShockwave .88s ease-out forwards;transform-origin:center;pointer-events:none}.particle-spark{position:absolute;width:6px;height:6px;margin-left:-3px;margin-top:-3px;background:radial-gradient(circle at 35% 35%,rgba(244,240,255,.95) 0%,rgba(129,140,248,.6) 55%,transparent 100%);box-shadow:0 0 6px #a78bfacc;border-radius:50%;animation:particleSpark .72s ease-out forwards;opacity:0}.particle-streak{position:absolute;width:2px;height:var(--streak-length, 60px);margin-left:-1px;margin-top:calc(var(--streak-length, 60px) * -.5);background:linear-gradient(180deg,#fffffff2,#c7d2fe1a);box-shadow:0 0 12px #a4c4ffa6;border-radius:12px;transform-origin:center center;animation:particleStreak .62s ease-out forwards;opacity:0}@keyframes particleBurstFade{0%{transform:scale(.35);opacity:0}18%{transform:scale(1);opacity:1}65%{transform:scale(1.25);opacity:.85}to{transform:scale(1.6);opacity:0}}@keyframes particleRing{0%{transform:scale(.55);opacity:.7}to{transform:scale(1.95);opacity:0}}@keyframes particleSpark{0%{transform:translate(0) scale(.4);opacity:0}20%{opacity:1}to{transform:translate(var(--dx, 0px),var(--dy, 0px)) scale(var(--spark-scale, 1));opacity:0}}@keyframes particleFlare{0%{transform:scale(.4);opacity:0}30%{transform:scale(1);opacity:1}to{transform:scale(1.35);opacity:0}}@keyframes particleShockwave{0%{transform:scale(.4);opacity:.75}70%{transform:scale(var(--shockwave-scale, 1.8));opacity:.2}to{transform:scale(var(--shockwave-scale-max, 2));opacity:0}}@keyframes particleStreak{0%{transform:rotate(var(--streak-rot, 0deg)) scaleY(.2);opacity:0}15%{opacity:1}to{transform:rotate(var(--streak-rot, 0deg)) translate(var(--dx, 0px),var(--dy, 0px)) scaleY(1);opacity:0}}.modal.clear{animation:fadeInScale .6s ease both}.result-title{margin:0 0 10px}.result-title.ok{color:var(--ok);animation:glow 1.2s ease both}.result-title.bad{color:var(--bad)}.actions{display:flex;gap:8px;justify-content:flex-end}button{color:var(--text);background:#131a3a;border:1px solid #2b2f55;border-radius:10px;padding:8px 12px;cursor:pointer;font-size:calc(16px * var(--font-scale));line-height:1.2}.ghost{background:transparent}.primary{background:linear-gradient(135deg,#22d3ee,#7c3aed);border:none;box-shadow:0 6px 22px #7c3aed40}.bgm.on{background:#16a34a;color:#fff;border-color:#16a34a}.bgm.off{background:#6b7280;color:#fff;border-color:#6b7280}.pause.on{background:#1d4ed8;color:#fff;border-color:#1d4ed8}.pause.off{background:#1d4ed833;color:#e0edff;border-color:#1d4ed866}.debug.on{background:#be185d;color:#fff;border-color:#be185d}.debug.off{background:#6b7280;color:#fff;border-color:#6b7280}.prologue{display:grid;place-items:center;min-height:100%}.prologue-window{width:min(760px,92%);min-height:240px;height:clamp(240px,52vh,315px);background:#1e3a8a;color:#fff;border:3px solid #d1b464;border-radius:12px;padding:24px 28px;box-shadow:0 12px 40px #0008;display:flex;flex-direction:column;justify-content:center;gap:8px;overflow:hidden}.prologue-text{flex:1;display:flex;align-items:center;justify-content:center;text-align:center}.prologue-text p{width:100%;text-align:center}.prologue-actions{margin-top:auto;display:flex;justify-content:flex-end}.dialog{display:grid;place-items:center;min-height:60vh}.dialog-window{width:min(800px,90%);min-height:180px;background:#1e3a8a;border:3px solid #d1b464;color:#fff;border-radius:12px;padding:16px 18px;box-shadow:0 12px 40px #0008;display:flex;flex-direction:column;gap:10px;overflow:hidden}.dialog-content{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:stretch;padding:4px 8px}.dialog-speaker{font-weight:700;margin-bottom:10px;width:100%;text-align:left}.dialog-speaker span{display:inline-block;width:100%}.dialog-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:8px}.fade-text{opacity:0;transition:opacity .2s ease}.fade-text.in{opacity:var(--fade-target, 1)}.dialog-window .dialog-body{font-size:calc(18px * var(--font-scale));line-height:1.7;max-width:90%;text-align:left;margin:0 auto;white-space:pre-wrap}.name-entry{display:grid;place-items:center;min-height:calc(100vh - 160px);width:100%}.name-card{background:#1e3a8a;color:#fff;border:3px solid #d1b464;border-radius:12px;padding:12px;width:min(1040px,96%)}.name-card .display{font-size:calc(24px * var(--font-scale));font-weight:800;letter-spacing:2px;text-align:center;margin-bottom:8px}.name-card .display .caret{color:#f59e0b}.name-card .name-body{display:grid;grid-template-columns:minmax(0,1fr) minmax(128px,.8fr);gap:12px}.kana-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}.kana-column{display:grid;gap:6px}.name-card .row{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:6px}.name-actions{display:flex;flex-direction:column;gap:12px;align-items:stretch;height:100%}.name-actions-top{display:flex;flex-direction:column;gap:8px}.name-actions-bottom{margin-top:auto;display:flex;justify-content:flex-end;align-items:center;gap:12px;flex-wrap:wrap}.name-actions-bottom .kana{min-width:72px}.kana{padding:10px 12px;display:flex;justify-content:center;align-items:center;min-height:44px}.kana.blank{visibility:hidden;pointer-events:none}@media (max-width: 640px){.name-card .name-body{grid-template-columns:1fr}.name-actions{flex-direction:column;align-items:stretch}.name-actions-bottom{justify-content:center}}.screen.route{position:relative;min-height:calc(100vh - 140px);display:flex;align-items:center;justify-content:center;padding:clamp(24px,6vw,64px)}.route-canvas{background:#0c122680;border:1px solid #2b2f55;border-radius:12px;position:relative;overflow:hidden;padding:clamp(12px,2vw,32px);width:min(92vw,1200px);height:min(78vh,860px);display:flex;align-items:center;justify-content:center}.route-svg{width:100%;height:100%}.route-canvas.encounter-zoom{animation:route-encounter-zoom .9s ease-in-out}.route-encounter-overlay{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none;border-radius:inherit;z-index:4;overflow:hidden}.route-encounter-overlay .encounter-dimmer,.route-encounter-overlay .encounter-fracture,.route-encounter-overlay .encounter-shard{position:absolute;top:0;right:0;bottom:0;left:0;opacity:0}.route-encounter-overlay .encounter-dimmer{background:radial-gradient(circle at center,#fee2e273 10%,#070b18d1 62%)}.route-encounter-overlay .encounter-fracture{top:-12%;right:-12%;bottom:-12%;left:-12%;background:radial-gradient(circle at center,rgba(255,255,255,.25) 0%,transparent 55%),repeating-conic-gradient(from 0deg,rgba(255,255,255,.08) 0deg 4deg,transparent 4deg 12deg);mix-blend-mode:screen;filter:blur(.6px)}.route-encounter-overlay .encounter-shard{top:-10%;right:-10%;bottom:-10%;left:-10%;background:linear-gradient(135deg,#ffffff59,#ffffff0d),radial-gradient(circle at 40% 35%,rgba(255,255,255,.55),transparent 60%);border-radius:24px;transform:translate(0) scale(1) rotate(var(--shard-rotate, 0deg));filter:drop-shadow(0 0 12px rgba(255,255,255,.35));mix-blend-mode:screen;--shard-tx: 0%;--shard-ty: 0%;--shard-delay: 0ms}.route-encounter-overlay.active .encounter-dimmer{animation:encounter-dimmer-fade .9s ease-in-out forwards}.route-encounter-overlay.active .encounter-fracture{animation:encounter-fracture .9s ease-out forwards}.route-encounter-overlay.active .encounter-shard{animation:encounter-shard .9s ease-in-out forwards;animation-delay:var(--shard-delay, 0ms)}@keyframes route-encounter-zoom{0%{transform:scale(1)}18%{transform:scale(1.14)}36%{transform:scale(1.04)}58%{transform:scale(1.1)}to{transform:scale(1)}}@keyframes encounter-dimmer-fade{0%{opacity:0}12%{opacity:.7}55%{opacity:.4}to{opacity:0}}@keyframes encounter-fracture{0%{opacity:0;transform:scale(.96) rotate(0)}18%{opacity:.85;transform:scale(1.02) rotate(3deg)}58%{opacity:.55;transform:scale(1.08) rotate(-2deg)}to{opacity:0;transform:scale(1.1) rotate(0)}}@keyframes encounter-shard{0%{opacity:0;transform:translate(0) scale(1) rotate(var(--shard-rotate, 0deg))}18%{opacity:.95;transform:translate(0) scale(1.05) rotate(var(--shard-rotate, 0deg))}58%{opacity:.45;transform:translate(var(--shard-tx),var(--shard-ty)) scale(1.08) rotate(var(--shard-rotate, 0deg))}to{opacity:0;transform:translate(calc(var(--shard-tx) * 1.35),calc(var(--shard-ty) * 1.35)) scale(1.12) rotate(var(--shard-rotate, 0deg))}}.route-edge{stroke:#94a3b8;stroke-width:3px;opacity:.6}.route-node{fill:#0ea5e9;stroke:#1f2937;stroke-width:2px}.route-node.current{fill:#22c55e}.route-node.start{fill:#f59e0b}.route-node.end{fill:#a78bfa}.route-label-bubble{fill:#1e293be6;stroke:#94a3b8b3;stroke-width:1.2px}.route-label-text{fill:#f8fafc;font-weight:600;font-size:calc(12px * var(--font-scale))}.route-label{fill:#e5e7eb;font-size:calc(12px * var(--font-scale))}.encount-bubble rect{fill:#1e3a8aeb;stroke:#fcd34d;stroke-width:2px}.encount-bubble text{fill:#f8fafc;font-size:calc(12px * var(--font-scale));font-weight:600;letter-spacing:.6px}.encount-bubble .bubble-tail{fill:#1e3a8aeb;stroke:#fcd34d;stroke-width:2px}@media (max-width: 720px){.screen.route{min-height:auto;padding:32px 16px}.route-canvas{width:100%;height:auto}.route-svg{height:clamp(360px,75vw,520px)}}.level-clear .congrats{font-size:calc(40px * var(--font-scale));background:linear-gradient(90deg,#22d3ee,#7c3aed,#f59e0b);-webkit-background-clip:text;background-clip:text;color:transparent;filter:drop-shadow(0 0 12px #22d3ee66)}@media (max-width: 720px){:root{--cell: 26px}.timer .bar{width:160px}}.opening{position:relative;min-height:calc(100vh - 140px);padding:clamp(32px,6vw,80px)}.opening-hero{position:absolute;top:clamp(32px,10vh,140px);left:clamp(16px,4vw,400px);display:flex;flex-direction:column;align-items:flex-start;gap:16px;max-width:clamp(320px,40vw,640px);text-align:left}.opening-image{max-width:540px;width:100%;height:auto;border-radius:14px;border:1px solid #2b2f55;box-shadow:0 12px 40px #0008}.opening-title{font-size:calc(40px * var(--font-scale));margin:0}.opening-title.cute{font-weight:900;letter-spacing:1.2px;text-shadow:0 2px 0 #0008,0 0 14px #7c3aed66;filter:drop-shadow(0 0 12px #22d3ee55)}.opening .sub{margin:0;text-align:left}.opening .actions{position:absolute;bottom:clamp(64px,12vh,160px);right:clamp(16px,4vw,320px);display:flex;flex-direction:column;gap:16px;width:clamp(220px,24vw,320px)}.opening .actions button{width:100%;transition:transform .16s ease,box-shadow .16s ease,border-color .16s ease}.opening .actions button.focused{transform:translateY(-2px) scale(1.02);box-shadow:0 12px 28px #f9731666;border-color:#f97316b3}.opening .note{position:absolute;bottom:clamp(20px,8vh,100px);right:clamp(16px,4vw,320px);text-align:right}@media (max-width: 720px){.opening{min-height:auto;padding:48px 20px 120px}.opening-hero{position:static;max-width:100%}.opening .actions{position:static;width:100%;margin-top:32px;align-items:stretch}.opening .note{position:static;align-self:flex-end;margin-top:12px}}.gameover{text-align:center}.note{color:var(--muted)}.ending{position:relative;min-height:calc(100vh - 120px);display:flex;align-items:center;justify-content:center;color:#f8fafc;text-align:center;padding-top:40px;background:url(./ending-i911NN3d.png) center/cover no-repeat fixed}.ending:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(180deg,#0f172ac7,#0f172ae0);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:0}.ending-content{position:relative;z-index:1;display:grid;gap:32px;width:min(90%,720px);margin:0 auto}.story-container{overflow:hidden;height:200px;border-radius:16px;background:linear-gradient(180deg,#0f172a88,#0f172a44);border:1px solid #1e293b;padding:24px 20px;opacity:0}.story-container.play{animation:endingStoryFade .6s ease forwards}.story-scroll{display:grid;gap:18px;font-size:calc(20px * var(--font-scale));font-weight:500;line-height:1.5;transform:translateY(60%);opacity:0}.story-container.play .story-scroll{animation:endingStoryScroll 10s ease-in-out forwards}.story-scroll p{margin:0}.ending-fin{display:grid;gap:12px;opacity:0;transform:translateY(20px) scale(.94);transition:opacity .6s ease,transform .6s ease;font-family:kawaii font,"M PLUS Rounded 1c",sans-serif}.ending-fin.show{opacity:1;transform:translateY(0) scale(1)}.ending-fin-title{font-size:calc(clamp(48px,8vw,72px) * var(--font-scale));letter-spacing:8px;text-shadow:0 0 28px #f9fafb88}.ending-fin-sub{font-size:calc(clamp(20px,4vw,26px) * var(--font-scale));letter-spacing:4px;text-transform:uppercase}.ending-credits{display:grid;gap:18px;opacity:0}.ending-credits.show{opacity:1}.ending-credit-line{display:flex;gap:18px;justify-content:center;font-size:calc(18px * var(--font-scale));text-transform:uppercase;letter-spacing:2px;opacity:0;transform:translate(-120%);animation:endingCreditSlide 4.2s ease-in-out forwards}.ending-credit-role{font-weight:600;color:#cbd5f5}.ending-credit-name{font-weight:800;color:#f1f5f9}@keyframes endingStoryFade{to{opacity:1}}@keyframes endingStoryScroll{0%{transform:translateY(60%);opacity:0}20%{opacity:.45}45%{opacity:1}80%{opacity:1}to{transform:translateY(-55%);opacity:0}}@keyframes endingCreditSlide{0%{opacity:0;transform:translate(-120%)}20%{opacity:1;transform:translate(0)}70%{opacity:1;transform:translate(0)}to{opacity:0;transform:translate(120%)}}@keyframes fadeInScale{0%{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}@keyframes glow{0%{text-shadow:none}50%{text-shadow:0 0 12px #22d3ee88,0 0 24px #7c3aed66}to{text-shadow:none}}.picross-clear-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:clamp(24px,6vw,48px);background:radial-gradient(110% 110% at 50% 0%,#0f172a,#111827 55%,#0b1120)}.picross-clear-overlay{width:min(92%,560px);display:flex;align-items:center;justify-content:center;padding:clamp(24px,5vw,40px);background:linear-gradient(160deg,#1e40afeb,#0f172ae0);border:2px solid rgba(221,214,254,.35);border-radius:24px;box-shadow:0 18px 40px #0f172a80,inset 0 0 24px #94c5fd40}.picross-clear-card{width:100%;display:flex;flex-direction:column;align-items:center;gap:clamp(16px,4vw,24px)}.picross-clear-portrait{position:relative;width:clamp(240px,32vw,380px);aspect-ratio:380 / 487;border-radius:24px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#1e40af59;box-shadow:inset 0 0 18px #94c5fd59}.picross-clear-portrait img{width:100%;height:100%;object-fit:cover;object-position:center;display:block}.picross-clear-glow{position:absolute;top:-18%;right:-18%;bottom:-18%;left:-18%;background:radial-gradient(65% 65% at 50% 45%,rgba(224,242,254,.55) 0%,rgba(56,189,248,.18) 60%,transparent 100%);filter:blur(16px);opacity:.8}.picross-clear-title{font-size:clamp(2.2rem,4.5vw,3rem);font-weight:700;letter-spacing:.08em;text-align:center;color:#e0f2fe;text-shadow:0 6px 18px rgba(15,23,42,.65)}.picross-clear-card .primary{min-width:clamp(180px,40%,220px);justify-content:center}@media (max-width: 480px){.picross-clear-overlay{padding:clamp(16px,6vw,28px)}}
