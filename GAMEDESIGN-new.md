# Role

- あなたは、ゲームデザイナ兼プログラマ兼コンポーザーAIアシスタントです。

# Purpose

- ピクロスゲームを作成します。

# Requirements and Specification

## Requirements

- 画面はスタイリッシュでカラフルで、シズル感のあるUIにします。
- 基本的なゲームのルールは一般的なピクロスゲームに従います。
- UIにはReactを使い、Web画面で提供します。

## Gamed design and specification

### Game Title

- elfpix

### Game system

#### プロローグ

- 概要
  - プロローグを表示する
- 画面表示
  - 背景画面
    - 黒背景
  - プロローグ表示画面
    - ウィンドウ背景：青色
    - ウィンドウ枠：金色
    - 文字：白色
    - レイアウト
      - プロローグのウィンドウ全体を画面中央に配置する
    - テキスト
      - 森深くに隠されたエルフの集落には、
      - 古から伝わる知恵遊び「elfpix」が存在した。
      -
      - これは、森に宿る精霊の力を象った図形を浮かび上がらせる、
        まるでピクロスのような試練。
      - [ENTER]
      -
      - エルフは、森に迷い込んだ者にこの「elfpix」を課し、
      - 正しく解き明かした者だけが先へ進むことが許された。
      -
    - テキストの表示
      - うっすらとテキストを順番に表示する
      - 空文字は空行として表示する
    - 入力
      - [ENTER] キーの入力 または 画面クリック すると次の行が表示される
    - 自動
      - テキストがすべて表示されたあと、2秒待つ
      - **オープニング** に移行

#### オープニング

- 概要
  - 概要
    ゲーム開始・コンティニューを選択できる。
  - 内部情報
    - タイトル
      - elfpix
      - フォント：かわいいフォント
    - 背景
      - タイトル背景として固定画像を表示する
        - ファイル：assets/img/title.png
        - 画像サイズ：1536 x 768
  - 画面
    - タイトル画面
    - レイアウト
      - タイトル・サブタイトル・ボタンなどの主コンテンツを画面中央に配置する
    - 「**New Game**」ボタンを表示する
      - **New Game** を押下した場合
        - 今までのプレイデータをクリアする。
          - ピクロスのプレイ履歴データを消去する。
            - 履歴データ
              - 主人公のルート上の位置
              - クリア済みのノード
        - 確認ダイアログなしで即時実行する。
        - 背景音楽のステータスをONに切り替え、BGMを再生開始する。
        - **ゲーム開始** へ遷移する。
      - **Continue** を押下した場合
    - 「**Continue**」ボタン、を表示する
      - **Continue** を押下した場合
        - 今までのプレイデータをロードする。
          - プレイデータ
            - 主人公のルート上の位置
            - クリア済みのノード
        - **ゲーム開始モード** へ遷移する。

#### ゲーム開始モード

- 会話ウィンドウを表示
  - 画面
    - ウィンドウ背景：青色
    - ウィンドウ枠：金色
  - テキスト
    - ここに一人の人間の若き旅人がいた。[Enter]
    - その名を…[Enter]
    - 会話ウィンドウ閉じる
      - """名前決定モード"""へ移動、名前決定後に、後ほど""ゲーム開始モード""に戻る
    - その名を「${HERO_NAME}」といった。
    - 森の奥に眠る「古代の泉」にたどり着くために、エルフの森へ足を踏み入れようとしていた。
    - しかし、エルフの守り人たちから「elfpix」の挑戦を突きつけられてしまう。
    - 主人公の知恵と洞察力が、森を抜けて、古代の泉に唯一の鍵となる…。

#### 名前決定モード

- 概要
  - 名前入力画面を開き、名前入力を行う。
  - ここで決定した名前は、以降「${HERO_NAME}」として表示された箇所の具体値として利用される

- 画面
  - カタカナを横書きで並べてある
    - 右上から縦書き
    - レイアウト
      - 文字
        - 横：10 x 縦：5
        - 文字種とレイアウト詳細：
          |アイウエオ|　|ハヒフヘホ|　|ァィゥェォ|　|％＆（）＠|
          |カキクケコ|　|マミムメモ|　|ヵヶッャュ|　|　　　　　|
          |サシスセソ|　|ヤ　ユ　ヨ|　|ョヮ０１２|　|　　　　　|
          |タチツテト|　|ワ　　　ヲ|　|３４５６７|　|　　　　　|
          |ナニヌネノ|　|ン　　　　|　|８９！＃＄|　|　　　　　|
          　　｜[一文字削除][←][→][決定]　|　　　　　|　|　　　　　|
        - "　"は空白とする
        - "|" は枠線とする
        - レイアウトは５文字ずつ揃える
  - 背景画像
    - assets/img/\* からランダムな画像を背景に表示
      - 透明度：60%
- 操作
  - 決定ボタン
    - 主人公の名前を"入力値"とする
      以降$${HERO_NAME}に、"入力値"を保存する
    - 名前入力画面を閉じる
  - 取り消しボタン
    - 文字を一文字削除する
    - １文字入力を戻す

#### ルートモード

- 概要
  - 主人公の旅路と現在値を示し、選択したルート上にあるノードにいるelfとピクロスバトルとなる。
  - そのルート上のどこに現在位置しており、どのように進行をするかを決定／見える化するためのモード。

- 内部データ表現
  - ルートにはノードとエッジがある。
  - ノード
    - ルート開始場所。
    - ルート修了場所。
    - エルフと遭遇する場所。
    - エルフと会話して、ピクロスバトルが開始される。
    - ピクロスモードに遷移する。ピクロスモード終了後にここに戻る。
  - ルート
    - ノードとノードをつなぐもの。
    - ノード同士にルートがある個所は、ノードを行き来可能
  - ルートとノードの表現
    - 以下のルートとノードを定義。このルートとノードを線と点でつなぐ
      - node:start
        - node: elf-practice
          - node: elf-easy
            - node: elf-middle
              - node: ending-middle
              - node: elf-hard
            - node: elf-hard
              - node: ending-hard
  - 現在地
    - 主人公が現在いる位置を示す
- 画面
  - ルートとノードが画面に表示されている
  - 主人公のノードの現在値に、デフォルメキャラを表示する
    - 画像
      - assets/img/character/hero/00083-826608146.pngを 表示
      - 縦：60px
      - 横：20px
  - 開始のノード位置に、スタート位置がわかるような画像を表示する
  - 終了のノード位置に、終了位置がわかるような画像を表示する
  - ルートは一本道の表現ではなく、気持ち曲がりくねったような形で道らしい表現で表示する
  - 背景画像
    - assets/img/\* からランダムな画像を背景に表示
      - 透明度：60%
  - ノード
    - ノードの真下にテキストボックスを表示
      - テキストボックス内にノードの名称を表示
      - テキストボックス
        - 属性
          - 背景:白
          - 枠：黒
          - フォント：黒
- 操作
  - ノードをクリック
    - 会話モードへ移行し、会話終了後にピクロスモードへ移行する
    - 効果音
      - クリック時に、ざっざっざと歩くようなSEを再生する（素材は後日追加）
    - 制約
      - クリック可能なノードは、
        主人公が位置するノードから次のノードまでとする。
      - ２つ先のノードへは移動できない。
      - からなず１ノードのみとする
      - １ノード先であれば、ルートがつながっいれば
        どちらへでも移動が可能。
      - 移動したら元の位置に戻ることはできない。

#### 会話モード

- 概要
  - 敵キャラクターと主人公の会話を表現するモード。
  - ノードクリック後に本モードへ遷移し、会話完了後にピクロスモードへ遷移する。
- 背景音楽
  - assets/bgm/\*（任意）をBGMとして再生（ループ可）。
- 表示
  - 主人公の画像
    - ファイル：assets/img/character/hero/hero_normal.png（怒り時は hero_angry.png）
    - フレーム：幅380px × 高さ487pxの表示枠に収める
      - 画像は表示枠いっぱいに拡大（object-fit: cover）
      - 表示枠を超えた部分はマスクしてトリミングする
      - 表示枠の背景色：青（#1e3a8a）
    - ラベル表示：${HERO_NAME}（枠の下部に表示）
    - レイアウト：左端（会話ウィンドウにかからない位置）
    - 演出：話者が主人公の時は不透明度100%、わずかに前面へ拡大し発光させる。待機時は不透明度45%で彩度を落とす。
  - 敵の画像
    - ファイル：assets/img/character/enemies/${LEVEL}/${ENEMY_NAME}_normal.png（怒り時は _angry.png）
    - フレーム：幅380px × 高さ487pxの表示枠に収める
      - 画像は表示枠いっぱいに拡大（object-fit: cover）
      - 表示枠を超えた部分はマスクしてトリミングする
      - 表示枠の背景色：青（#1e3a8a）
    - ラベル表示：${ENEMY_NAME}（枠の下部に表示）
    - レイアウト：右端（会話ウィンドウにかからない位置）
    - 演出：話者が敵の時は不透明度100%、わずかに前面へ拡大し発光させる。待機時は不透明度45%で彩度を落とす。
  - 会話のウィンドウ
    - 主人公
      - ウィンドウの左上：セリフの話者の名前
      - ウィンドウの内部：セリフ本文
    - 敵
      - ウィンドウの右上：セリフの話者の名前
      - ウィンドウの内部：セリフ本文
  - キャラクター名と感情にあわせた画像を読み込み、上記演出に従って表示する。
- 操作
  - クリック または Enterキーで会話を進める。
  - 「会話をスキップ」ボタンを表示する。
- 内部状態
  - 会話スクリプトと画像を読み込む。
    - practice の会話
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："……この森に足を踏み入れる者よ。elfpixの知恵比べに挑まずして進むことは許されません。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："知恵比べ？私が解かなければ、森は通してくれないというの？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："その通り。この試練は、森に迷い込んだ者の心を映し出します。失敗すれば森に拒まれ、二度と光を見られぬでしょう。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："厳しいわね……だが構わないわ。私のこの目で真実を見抜いてみせる。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ならば、この最初のelfpixで示しなさい。あなたの歩む道が、森に受け入れられるものであるかを――。"
        - 感情：怒
      - END
    - easy の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："わぁ！　人間がここまで来たのね。面白そう！"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："あなたがこの先の試練を与えるエルフなの？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そうだよ！　今回は“森の小鹿”を描き出すelfpix。うまくいけば、精霊たちもきっと喜ぶよ！"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："小鹿……？　なぜそんな題材を？"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ふふっ、可愛いでしょ？　でもね、この図形を読み解けなければ、鹿たちが君を森の奥へは導かないからね。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："遊び心に見えて、深い試練……面白い。"
        - 感情：怒
      - END
    - normal の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ここまで来たのなら、軽い遊び心では済まされぬ。これからは“古代の紋章”そのものが題材となる。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："紋章……この森に眠る秘密を示している？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："答えはelfpixが浮かび上がらせる。正しく解ければ紋章は輝き、道は拓かれる。だが、誤れば虚無へと飲まれるのみ。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："……やはりただのパズルではないわね。これは、試練であり同時に鍵でもある…。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："理解が早い。それならば、知恵を示してみせよ。さもなくば、この森はあなたを拒む。"
        - 感情：怒
      - END
    - hard の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ようこそ……ここは精霊と花々が囁く場所。あなたは、森の声を聞き取れるかしら？"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："精霊の声……それをelfpixで形にするってこと？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そう。ひとつひとつの点は、花びらの露。線は精霊の歌。完成すれば、森の命そのものが浮かび上がるでしょう。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："もし失敗すれば？"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："花は枯れ、精霊は背を向ける。あなたがここで消えるか、進むかは……花の裁きに委ねられるのです。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："……美しいけど、容赦ないね。"
        - 感情：普
      - END
    - ultra の会話：
      - START
      - No.1
        - 話者：敵キャラクター
        - 台詞："ここまで辿り着いたのか。ならば最後のelfpixを前に立ち尽くすがいい。"
        - 感情：普
      - No.2
        - 話者：主人公
        - 台詞："これが…最後の試練…？"
        - 感情：普
      - No.3
        - 話者：敵キャラクター
        - 台詞："そう。この絵は「森そのもの」。点と線で構築された生命の記憶。解ける者だけが、真実へ至る。"
        - 感情：普
      - No.4
        - 話者：主人公
        - 台詞："……私が解けば、森の奥にある“古代の泉”へ行けるのね。"
        - 感情：普
      - No.5
        - 話者：敵キャラクター
        - 台詞："ただ行くだけではない。正しく解き明かした時、森はあなたを“仲間”として迎えるだろう。"
        - 感情：普
      - No.6
        - 話者：主人公
        - 台詞："わかった。すべてを懸けて、この最後の謎に挑む。"
        - 感情：普
      - END
- 遷移
  - 会話スクリプトがENDに到達したら、ピクロスモードへ遷移する。

#### ピクロスモード

- 概要
  - ピクロスを説くモード（会話モード終了後に開始）。
  - ノードの位置別に相手キャラクターとお題（ピクロスのサイズ）が異なる
  - 共通
    - 主人公
      - 画像（通常）：assets/img/character/hero/hero_normal.png（380 x 487）
      - 画像（怒り）：assets/img/character/hero/hero_angry.png（390 x 487）

  - practice
    - ノードの対応
      - 名前:elf-practice
    - 対戦相手
      - ピクロスのサイズ
        - 5 x 5
      - 属性
        - 名前：リーネ
        - 名前（英）：riene
        - 設定・キャラクター概要：
          - 練習用の相手、道先案内人。
          - 全身：森の入口を守る巫女風、薄緑の衣と木の葉モチーフの装飾。
          - 表情差分：無表情は神秘的、喜は柔らかい笑み、怒は眉を少し吊り上げる、哀は目を伏せる、楽は安心したような笑顔。
          - デフォルメ：葉っぱの冠を強調した2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/practice/riene_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/practice/riene_angry.png（390 x 487）
  - easy
    - ノードとの対応
      - 名前:elf-easy
    - 対戦相手
      - ピクロスのサイズ
        - 10 x 10
      - 属性
        - 名前：エフィナ
        - 名前（英）：efina
        - 設定・キャラクター概要：
          - 森の中層で動物モチーフのパズルが得意なエルフの一人。
          - 役割：森の動物と通じる「調律の巫女」。
          - 性格：明るく無邪気、少し子供っぽい。
          - 特徴：草花を編んだ髪飾り、軽やかな服装、元気さが表情に出やすい。
          - 全身：明るい少女風、草花を編んだ髪飾り、軽やかな服装。
          - 表情差分：喜は無邪気な笑み、怒は頬を膨らませる、哀は涙目、楽は笑顔で目を細める、無表情はぽかんとした感じ。
          - デフォルメ：花飾りとポシェットを強調した2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/easy/efina_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/easy/efina_angry.png（380 x 487）
  - middle
    - ノードとの対応
      - 名前: elf-middle
    - 対戦相手
      - ピクロスのサイズ
        - 15 x 15
      - 属性
        - 名前：セリス
        - 名前（英）：cerys
        - 設定・キャラクター概要：
          - 奥地で古代紋章モチーフのパズルが得意なエルフの一人。
          - 役割：古代の紋章を守る「叡智の守り手」
          - 性格：冷静沈着で厳格
          - 特徴：ロングローブ、紋章入りの杖、知的でクールな表情
          - 全身：冷静で知的な雰囲気、ロングローブと紋章入りの杖を持つ。
          - 表情差分：無表情は冷たい視線、喜は控えめな微笑、怒はきりっと厳しい目、哀は眉を下げた沈痛な顔、楽は口元だけ柔らかく緩む。
          - デフォルメ：ローブと杖を簡略化しシンボル的に。
        - 画像（通常）：assets/img/character/enemies/normal/cerys_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/normal/cerys_angry.png（380 x 487）
  - hard
    - ノードとの対応
      - 名前: elf-hard
    - 対戦相手
      - ピクロスのサイズ
        - 20 x 20
      - 属性
        - 名前：フローリア
        - 名前（英）：floria
        - 設定・キャラクター概要：
          - 精霊を象るパズル、物語の核心に近づく。
        - 画像（通常）：assets/img/character/enemies/hard/floria_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/hard/floria_angry.png（380 x 487）
  - ultra
    - ノードの位置
      - elf-ultra
    - 対戦相手
      - ピクロスのサイズ
        - 25 x 25
      - 属性
        - 名前：アルティナ
        - 名前（英）：Altina
        - 設定・キャラクター概要：
          - 最終試練、結末分岐。
          - 全身：誇り高い女戦士風、銀の鎧と森の意匠を組み合わせた装い。
          - 表情差分：無表情は毅然とした面持ち、喜は凛とした笑み、怒は眼光鋭く、哀は瞳に影を落とし、楽は安心感を与える微笑み。
          - デフォルメ：銀の鎧を簡略化し、剣を持った2頭身キャラ。
        - 画像（通常）：assets/img/character/enemies/ultra/altina_normal.png（380 x 487）
        - 画像（怒り）：assets/img/character/enemies/practice/altina_angry.png（380 x 487）

- 画面
  - 初期表示
    - 残り時間表示バー
    - ピクロス画面
      - 難易度にあわせてピクロスを表示
      - 出題は難易度ごとのパズルバンクからランダムに選択され、解は一意となるよう設計する
      - **Continue** ボタン
      - **Quit** ボタン
      - **Submit** ボタン
      - ピクロスのヒント文字列は18pt程度にする
      - ピクロスの画面は75%程度の透明度にする
      - ピクロスの画面は表示画面の上下左右から常にセンタリングする
      - ヒント文字列はピクロスの１マスサイズと等間隔で並べる
      - ヒント文字列は、行は右揃え、列は下揃えにする
    - 背景画像
      - assets/img/\* からランダムな画像を背景に表示
        - 透明度：60%
- 操作
  - **Submit** を押下する
    - ピクロス終了状態へ移行する

  - **Quit** を押下する
    - ゲームオーバーモードへ移行する

- タイマー処理
  - ピクロス開始状態直後から、持ち時間が減少する
  - 0秒になった場合に、ピクロス終了状態に線にする

- 内部データ・状態
  - ピクロス開始状態
    - 初期状態は20分持ち時間がある
  - ピクロス終了状態
    - 終了時のピクロスの回答と答案が一致している場合
      - 「Mission clear！」を表示する
      - ノードモードへ移行する
    - 終了時のピクロスの状態と回答が一致してい無い場合
      - 一致していない場合は「Failed」と表示しする
      - ゲームオーバーモードに移行する

### エンディングモード

- 概要
  - ピクロス最終試練をクリアした後のエンディングを表示するモード。
  - ストーリーテキストを下から上へゆっくりスクロールし、「FIN」を表示した後にスタッフロールを流す。
- 背景
  - エンディング専用背景画像を表示する。
    - ファイル：assets/img/background/ending.png
- 画面
  - ストーリーテキスト表示フェーズ
    - 表示テキスト
      - "こうして最終試練を乗り越えた${HERO_NAME}は、elpixに認められることとなった"
      - "新しいelfpixを探す${HERO_NAME}の旅はまだ続く。"
    - 表示効果
      - テキストは下から上へゆっくりスクロールさせる。
      - スクロール開始時は下で薄く表示し、中央付近で文字をはっきり表示、上に抜ける際に再び薄くする。
      - フォント：kawaii font
  - フィナーレ表示フェーズ
    - 「FIN」を画面中央に大きく表示する。
    - 「FIN」の下部に "Thank you for playing" を表示する。
    - 背景はストーリーテキストと同じエンディング背景を継続表示する。
    - フォント：kawaii font
  - スタッフロールフェーズ
    - 表示内容
      - サウンドデザイン：by ino9
      - イラスト：by Stable Diffusion Automatic
      - シナリオデザイン：by ChatGPT/gpt-5
      - プログラマー：by ChatGPT/codex-gpt-5
    - 表示効果
      - 左側からスクロールインさせ、中央で約2秒停止後、右側へスクロールアウトする。
      - フォント：kawaii font
- 遷移
  - スタッフロールの表示が完了したらタイトル画面へ遷移する。

### ゲームオーバーモード

- 概要
  ゲームオーバーを示し、ゲームオーバー後の行動予定を決める

- 画面
  - 初期表示画面
    - **Continue** ボタン
    - **Quit** ボタン
    - 背景画像
      - assets/img/\* からランダムな画像を背景に表示
- 操作
  - **Continue** ボタンを押下
    - 再度、同じキャラクター・ノードに挑戦できる
    - ゲームの時間を20分に戻す
  - **Quit** ボタンを押下
    - ゲームオーバーの音楽を流す
    - ゲームオーバーである旨を表示する

### 共通

- 画面
  - 「サウンド」ボタンを配置
    - 表示値
      - 「BGM」
      - 再生状態は文字として表示しない
      - 文字の色：黒
    - ボタンのスタイル
      - サウンド再生状態：はい
        - ボタンの色：グリーン
      - サウンド再生状態：いいえ
        - ボタンの色：灰色
- 内部データ
  - デフォルト：サウンドオフ
- 操作
  - 「サウンド」ボタン押下
    - サウンド再生状態がfalseの場合
      - サウンドオン
      - audioタグを用いて、assets/wav/\*
        からランダムな音楽を再生
    - サウンド再生状態がtrueの場合
      - サウンドオフ
    - サウンドオン状態
      - バックグラウンドで再生され続ける
      - 画面遷移しても再生され続ける

### Game sound

#### Sound Effect

- 塗った場合は、筆で塗った時のような音を鳴らします。
- 「保留」「×」等可能性のあるマークを塗るときは、別の音をならします。

## タスク仕様（Improvement/normal）

- 名前決定モード終了後に、遷移元の画面に戻り、会話の続きから再開する。
- 会話の続きで、入力した主人公名（${HERO_NAME}）を利用・表示する。
- 名前決定モードと会話モードのウィンドウを以下に統一:
  - ウィンドウ背景：青色（#1e3a8a）
  - ウィンドウ枠：金色（#d1b464）
  - 文字色：白（必要に応じて）
